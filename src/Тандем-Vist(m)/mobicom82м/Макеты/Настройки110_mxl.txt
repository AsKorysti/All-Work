												
												
Параметр	Значение											
Компания	--											
Дистрибьютор	МобиКом											
Версия	2016.06.10											
Конфигурация	УТ110											
												
												
Имя раздела	Наименование	Выключено	Замещение	Таб.часть	Связка	Отбор	Тип объекта	Комментарий				
ref_firms	Фирмы		false			Организации	С	Организации				
ref_stores	Склады		false			Склады	С	Склады				
ref_employees	Сотрудники		false			Пользователи	С	ФизическиеЛица				
ref_cashregisters	Кассы	Х	false				С	Кассы				
ref_pricetypes	Типы цен		false			*ВидыЦен	С	ТипыЦенНоменклатуры				
ref_units	Единицы измерения (ОКЕИ)		false			*ЕдиницыИзмерения	С	КлассификаторЕдиницИзмерения				
ref_buyers	Владельцы / покупатели		false			Контрагенты	С	Контрагенты				
ref_counteragents	Контрагенты / юр.лица / плательщики		false			*Контрагенты	С	Контрагенты				
ref_buypointtypes	Типы торговых точек	Х	false				С					
ref_buypoints	Торговые точки		false			*Партнеры	С	Контрагенты				
ref_agreements	Договора		false			*СоглашенияСКлиентами	С	ДоговорыКонтрагентов				
ref_agreementbuypoints	Обслуживаемые по договору ТТ		true				С					
ref_territories	Территории агентов		true				С					
ref_skugroups	Товарные группы		false			Номенклатура	С	Номенклатура				
ref_skus	Товары		false			Номенклатура	С	Номенклатура				
ref_skuunits	Единицы измерения товаров		true			*ЕдиницыИзмерения	С	ЕдиницыИзмерения				
ref_skuimages	Изображения товаров	Х	false									
ref_docstates	Статусы состояния документа	Х	false				С					
ref_paytypes	Типы оплаты	Х	false				С					
doc_invoices	(док) Продажи		false	doc_invoiceskus	invoice	*РеализацияТоваровУслуг	Д	РеализацияТоваровУслуг				
reg_rests	(рег) Остатки товаров		true				Р					
reg_debts	(рег) Задолженности		true				Р					
reg_prices	(рег) Цены товаров		true				Р	ЦеныНоменклатуры				
												
Имя раздела	Наименование	Выключено	Замещение	Таб.часть	Связка	Отбор	Тип объекта	Комментарий				
doc_preorders	(док) Заявки		false	doc_preorderskus	preorder	ЗаказКлиента	Д	ЗаказКлиента				
doc_receiptcashorders	(док) ПКО		false	doc_receiptcashorderitems	receiptcashorder	ПриходныйКассовыйОрдер	Д	ПриходныйКассовыйОрдер				
doc_goodsreturns	(док) Возвраты		false	doc_goodsreturnskus	goodsreturn	ВозвратТоваровОтКлиента	Д	ВозвратТоваровОтПокупателя				
ref_buyercensus	Новые владельцы	Х	false			Контрагенты	С					
ref_buypointcensus	Новые торг.точки	Х	false			Партнеры	С					
												
												
												
	Если в начале стоит * - реквизит не участвует в обмене	Если в начале стоит * - отбор по фильтру не используется										
												
Фирмы												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
name	Наименование		Наименование		"ВЫБРАТЬ
	Организации.Ссылка,
	Организации.Наименование,
//	Организации.Код,
	Организации.ПометкаУдаления,
	ЕСТЬNULL(ВложенныйЗапросАдрес.Представление, """") КАК Адрес,
	ЕСТЬNULL(ВложенныйЗапросТелефон.Представление, """") КАК Телефон,
	ИСТИНА КАК ПлательщикНДС,
	Организации.ИНН,
	Организации.КПП
ИЗ
	Справочник.Организации КАК Организации
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			КонтактнаяИнформация.Представление КАК Представление,
			КонтактнаяИнформация.Ссылка КАК Объект
		ИЗ
			Справочник.Организации.КонтактнаяИнформация КАК КонтактнаяИнформация
		ГДЕ
			КонтактнаяИнформация.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.Адрес)
			И КонтактнаяИнформация.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ФактАдресОрганизации)) КАК ВложенныйЗапросАдрес
		ПО Организации.Ссылка = ВложенныйЗапросАдрес.Объект
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			КонтактнаяИнформация.Представление КАК Представление,
			КонтактнаяИнформация.Ссылка КАК Объект
		ИЗ
			Справочник.Организации.КонтактнаяИнформация КАК КонтактнаяИнформация
		ГДЕ
			КонтактнаяИнформация.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.Телефон)
			И КонтактнаяИнформация.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ТелефонОрганизации)) КАК ВложенныйЗапросТелефон
		ПО Организации.Ссылка = ВложенныйЗапросТелефон.Объект"	0						
printcode	*Код		Код объекта									
deleted	ПометкаУдаления		Пометка на удаление									
address	Адрес		Адрес									
phone	Телефон		Телефон									
vatstatus	ПлательщикНДС		Плательщик НДС									
inn	ИНН		ИНН									
kpp	КПП		КПП									
												
												
Склады												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
name	Наименование		Наименование		"ВЫБРАТЬ
	Склады.Ссылка,
	Склады.Наименование,
//	Склады.Код,
	Склады.ПометкаУдаления
ИЗ
	Справочник.Склады КАК Склады
ГДЕ
	Склады.ЭтоГруппа = ЛОЖЬ"	1						
printcode	*Код		Код объекта									
deleted	ПометкаУдаления		Пометка на удаление									
												
												
Сотрудники												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
name	Наименование		Наименование		"ВЫБРАТЬ
	Пользователи.Ссылка,
	Пользователи.Наименование,
//	Пользователи.Код,
	Пользователи.ПометкаУдаления
ИЗ
	Справочник.Пользователи КАК Пользователи"	0						
printcode	*Код		Код объекта									
deleted	ПометкаУдаления		Пометка на удаление									
store	*Склад	ref_stores	Ссылка на склад		ВложенныйЗапросСклады.СтруктурнаяЕдиница							
firstname	*Имя		Имя									
lastname	*Фамилия		Фамилия									
middlename	*Отчество		Отчество									
inn			ИНН									
post			Должность									
phone			Телефон									
route			Номер маршрута									
startlatitude			Отправная точка движения по маршруту: широта									
startlongitude			Отправная точка движения по маршруту: долгота									
finishlatitude			Конечная точка движения по маршруту: широта									
finishlongitude			Конечная точка движения по маршруту: долгота									
plannedtrackweekcount			Число недель планируемого маршрута									
												
												
Кассы												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
name	Наименование		Наименование		"ВЫБРАТЬ
	Кассы.Ссылка,
	Кассы.Наименование,
//	Кассы.Код,
	Кассы.ПометкаУдаления,
	Кассы.Владелец КАК Организация
//	ЕСТЬNULL(ВложенныйЗапросКассы.ФизическоеЛицо, НЕОПРЕДЕЛЕНО) КАК ФизическоеЛицо
ИЗ
	Справочник.Кассы КАК Кассы
//		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
//			ОтветственныеЛицаСрезПоследних.СтруктурнаяЕдиница КАК СтруктурнаяЕдиница,
//			ОтветственныеЛицаСрезПоследних.ФизическоеЛицо КАК ФизическоеЛицо
//		ИЗ
//			РегистрСведений.ОтветственныеЛица.СрезПоследних(&ДатаФормирования, ) КАК ОтветственныеЛицаСрезПоследних
//		ГДЕ
//			ТИПЗНАЧЕНИЯ(ОтветственныеЛицаСрезПоследних.СтруктурнаяЕдиница) = ТИП(Справочник.Склады)) КАК ВложенныйЗапросКассы
//		ПО Кассы.Ссылка = ВложенныйЗапросКассы.СтруктурнаяЕдиница"	0						
printcode	*Код		Код объекта									
deleted	ПометкаУдаления		Пометка на удаление									
firm	Организация	ref_firms	Ссылка на собственную фирму		Кассы.Владелец							
employee	*ФизическоеЛицо	ref_employees	Ссылка на сотрудника		ВложенныйЗапросКассы.ФизическоеЛицо,							
store		*ref_stores	Ссылка на склад									
												
												
Типы цен												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
name	Наименование		Наименование		"ВЫБРАТЬ
	ТипыЦенНоменклатуры.Ссылка,
	ТипыЦенНоменклатуры.Наименование,
	ТипыЦенНоменклатуры.ПометкаУдаления,
	ТипыЦенНоменклатуры.СпособЗаданияЦены,
	ТипыЦенНоменклатуры.АлгоритмРасчетаЦены,
	ТипыЦенНоменклатуры.Идентификатор,
	ТипыЦенНоменклатуры.ИспользоватьПриПродаже
ИЗ
	Справочник.ВидыЦен КАК ТипыЦенНоменклатуры"	1	"// парсим формулы
лОбъекты.Колонки.Добавить(""БазовыйТипЦен"");
лОбъекты.Колонки.Добавить(""Наценка"");
Для Каждого стрДоп Из лОбъекты Цикл
	Если стрДоп.СпособЗаданияЦены = Перечисления.СпособыЗаданияЦен.Вручную ИЛИ
		стрДоп.СпособЗаданияЦены = Перечисления.СпособыЗаданияЦен.ЗаполнятьПоДаннымИБ ИЛИ
		стрДоп.СпособЗаданияЦены = Перечисления.СпособыЗаданияЦен.ЗаполнятьПоДаннымИБПриПоступлении Тогда
			Продолжить;
	КонецЕсли;

	Если СтрЧислоВхождений(стрДоп.АлгоритмРасчетаЦены,""["")<>1 Тогда
		СообщитьПодробно(""Не удалось обработать формулу '""+стрДоп.АлгоритмРасчетаЦены+""' в ""+стрДоп.Наименование, СтатусСообщения.Важное, Истина, Ложь);
		Продолжить;
	КонецЕсли;
	
	позНач = Найти(стрДоп.АлгоритмРасчетаЦены,""["");
	позКон = Найти(стрДоп.АлгоритмРасчетаЦены,""]"");
	лИдентификаторБазовойЦены = Сред(стрДоп.АлгоритмРасчетаЦены, позНач+1, позКон-ПозНач-1);
	
	стрБазоваяЦена = лОбъекты.Найти(лИдентификаторБазовойЦены,""Идентификатор"");
	Если стрБазоваяЦена=Неопределено Тогда
		СообщитьПодробно(""Для ""+стрДоп.Наименование+"" базовая цена не входит в список выгружаемых"", СтатусСообщения.Важное, Истина, Ложь);
		Продолжить;
	Иначе
		стрБазоваяЦена.ИспользоватьПриПродаже = Истина;
	КонецЕсли;
	лОстатокФормулы = СокрЛП(СтрЗаменить(стрДоп.АлгоритмРасчетаЦены, ""[""+лИдентификаторБазовойЦены+""]"",""""));
	
	Если Лев(лОстатокФормулы,1)=""*"" Тогда
		лКоэффициент = СокрЛП(Сред(лОстатокФормулы,2));
	ИначеЕсли Прав(лОстатокФормулы,1)=""*"" Тогда
		лКоэффициент = СокрЛП(Сред(лОстатокФормулы,1,СтрДлина(лОстатокФормулы)-1));
	Иначе
		СообщитьПодробно(""Не удалось обработать формулу '""+стрДоп.АлгоритмРасчетаЦены+""' в ""+стрДоп.Наименование, СтатусСообщения.Важное, Истина, Ложь);
		Продолжить;
	КонецЕсли;
	
	Попытка
		лКоэффициент = Число(лКоэффициент);
	Исключение
		СообщитьПодробно(""Не удалось обработать формулу '""+стрДоп.АлгоритмРасчетаЦены+""' в ""+стрДоп.Наименование, СтатусСообщения.Важное, Истина, Ложь);
		Продолжить;
	КонецПопытки;
	
	стрДоп.БазовыйТипЦен = стрБазоваяЦена.Ссылка;
	стрДоп.Наценка = (лКоэффициент-1)*100;
КонецЦикла;

мСтрДоп = лОбъекты.НайтиСтроки(Новый Структура(""ИспользоватьПриПродаже"",Ложь));
Для Каждого стрДоп Из мСтрДоп Цикл
	лОбъекты.Удалить(стрДоп);
КонецЦикла;

// сортируем типы цен
лОбъекты.Колонки.Добавить(""Представление"");
Для Каждого стрДоп Из лОбъекты Цикл
	лТЦ = стрДоп;
	лПредставление = """";
	Пока ЗначениеЗаполнено(лТЦ.БазовыйТипЦен) Цикл
		лТЦСсылка = лТЦ.БазовыйТипЦен;
		лТЦ = лОбъекты.Найти(лТЦСсылка,""Ссылка"");
		лПредставление = лТЦ.Наименование+""\""+лПредставление;
	КонецЦикла;
	стрДоп.Представление = лПредставление + стрДоп.Наименование;
КонецЦикла;
лОбъекты.Сортировать(""Представление"");"					
printcode	*Код		Код объекта									
deleted	ПометкаУдаления		Пометка на удаление									
parentpricetype	БазовыйТипЦен	*ref_pricetypes	Ссылка на базовый тип цены									
extrarate	Наценка		Процент наценки на цену базового типа									
												
												
Единицы измерения (ОКЕИ)												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
name	КраткоеНаименование		Наименование		"ВЫБРАТЬ
	КлассификаторЕдиницИзмерения.Ссылка,
	КлассификаторЕдиницИзмерения.НаименованиеПолное КАК Наименование,
	КлассификаторЕдиницИзмерения.Код,
	КлассификаторЕдиницИзмерения.ПометкаУдаления,
	КлассификаторЕдиницИзмерения.МеждународноеСокращение КАК КраткоеНаименование
ИЗ
	Справочник.ЕдиницыИзмерения КАК КлассификаторЕдиницИзмерения"	0						
printcode	Код		Код объекта									
deleted	ПометкаУдаления		Пометка на удаление									
shortname	Наименование		Короткое наименование									
												
												
Владельцы / покупатели												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
name	Наименование		Наименование		"ВЫБРАТЬ
	Контрагенты.Ссылка,
	Контрагенты.Наименование,
//	Контрагенты.Код,
	Контрагенты.ПометкаУдаления,
	ЕСТЬNULL(ВложенныйЗапросАдрес.Представление, """") КАК Адрес,
	ЕСТЬNULL(ВложенныйЗапросТелефон.Представление, """") КАК Телефон
//	ЕСТЬNULL(Контрагенты.ОсновноеКонтактноеЛицо.Наименование, """") КАК КонтактноеЛицо,
//	ЕСТЬNULL(Контрагенты.ОсновнойДоговорКонтрагента.КонтролироватьЧислоДнейЗадолженности, ЛОЖЬ) КАК КонтролироватьЧислоДнейЗадолженности,
//	ЕСТЬNULL(Контрагенты.ОсновнойДоговорКонтрагента.ВалютаВзаиморасчетов, НЕОПРЕДЕЛЕНО) КАК ВалютаВзаиморасчетов,
//	ЕСТЬNULL(Контрагенты.ОсновнойДоговорКонтрагента.ДопустимаяСуммаЗадолженности, 0) КАК ДопустимаяСуммаЗадолженности,
//	ЕСТЬNULL(Контрагенты.ОсновнойДоговорКонтрагента.ДопустимоеЧислоДнейЗадолженности, 0) КАК ДопустимоеЧислоДнейЗадолженности
ИЗ
	Справочник.Контрагенты КАК Контрагенты
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			КонтактнаяИнформация.Представление КАК Представление,
			КонтактнаяИнформация.Ссылка КАК Объект
		ИЗ
			Справочник.Контрагенты.КонтактнаяИнформация КАК КонтактнаяИнформация
		ГДЕ
			КонтактнаяИнформация.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.Адрес)
			И КонтактнаяИнформация.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ФактАдресКонтрагента)) КАК ВложенныйЗапросАдрес
		ПО Контрагенты.Ссылка = ВложенныйЗапросАдрес.Объект
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			КонтактнаяИнформация.Представление КАК Представление,
			КонтактнаяИнформация.Ссылка КАК Объект
		ИЗ
			Справочник.Контрагенты.КонтактнаяИнформация КАК КонтактнаяИнформация
		ГДЕ
			КонтактнаяИнформация.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.Телефон)
			И КонтактнаяИнформация.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ТелефонКонтрагента)) КАК ВложенныйЗапросТелефон
		ПО Контрагенты.Ссылка = ВложенныйЗапросТелефон.Объект"	0						
printcode	*Код		Код объекта									
deleted	ПометкаУдаления		Пометка на удаление									
store		ref_stores	Ссылка на склад отгрузки									
pricetype	*ТипЦен	*ref_pricetypes	Ссылка на тип цен		Контрагенты.ОсновнойДоговорКонтрагента.ТипЦен							
address	Адрес		Адрес									
phone	Телефон		Телефон									
contact	*КонтактноеЛицо		Контактное лицо									
canexceedlimit	*КонтролироватьЧислоДнейЗадолженности		Признак разрешения превышать срок кредита									
creditlimit	*ДопустимаяСуммаЗадолженности		Ограничение суммы кредита в основной валюте									
creditdeadline	*ДопустимоеЧислоДнейЗадолженности		Ограничение глубины кредита в днях									
maxorderamount			Ограничение максимальной сумма заказа									
minorderamount			Ограничение минимальной сумма заказа									
maxdiscount			Ограничение максимального процента скидки									
mindiscount			Ограничение минимального процента скидки									
												
												
Контрагенты / юр.лица / плательщики												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
name	Наименование		Наименование		"ВЫБРАТЬ
	Контрагенты.Ссылка,
	Контрагенты.Наименование,
//	Контрагенты.Код,
	Контрагенты.ПометкаУдаления,
	Контрагенты.Ссылка КАК Покупатель,
	ЕСТЬNULL(ВложенныйЗапросАдрес.Представление, """") КАК Адрес,
	ЕСТЬNULL(ВложенныйЗапросТелефон.Представление, """") КАК Телефон,
	ВЫБОР
		КОГДА Контрагенты.ЮрФизЛицо = ЗНАЧЕНИЕ(Перечисление.ЮрФизЛицо.ЮрЛицо)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ЮрЛицо,
	Контрагенты.ИНН,
	Контрагенты.КПП,
//	""р/с "" + ЕСТЬNULL(Контрагенты.ОсновнойБанковскийСчет.НомерСчета, ""--"") + "", "" + ""в банке "" + ЕСТЬNULL(Контрагенты.ОсновнойБанковскийСчет.Банк.Наименование, ""--"") + "", "" + ""БИК "" + ЕСТЬNULL(Контрагенты.ОсновнойБанковскийСчет.Банк.Код, ""--"") + "", "" + ""к/с "" + ЕСТЬNULL(Контрагенты.ОсновнойБанковскийСчет.Банк.КоррСчет, ""--"") КАК БанкРеквизиты,
	Контрагенты.КодПоОКПО КАК ОКПО
ИЗ
	Справочник.Контрагенты КАК Контрагенты
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			КонтактнаяИнформация.Представление КАК Представление,
			КонтактнаяИнформация.Ссылка КАК Объект
		ИЗ
			Справочник.Контрагенты.КонтактнаяИнформация КАК КонтактнаяИнформация
		ГДЕ
			КонтактнаяИнформация.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.Адрес)
			И КонтактнаяИнформация.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ФактАдресКонтрагента)) КАК ВложенныйЗапросАдрес
		ПО Контрагенты.Ссылка = ВложенныйЗапросАдрес.Объект
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			КонтактнаяИнформация.Представление КАК Представление,
			КонтактнаяИнформация.Ссылка КАК Объект
		ИЗ
			Справочник.Контрагенты.КонтактнаяИнформация КАК КонтактнаяИнформация
		ГДЕ
			КонтактнаяИнформация.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.Телефон)
			И КонтактнаяИнформация.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ТелефонКонтрагента)) КАК ВложенныйЗапросТелефон
		ПО Контрагенты.Ссылка = ВложенныйЗапросТелефон.Объект"	0						
printcode	*Код		Код объекта									
deleted	ПометкаУдаления		Пометка на удаление									
buyer	Покупатель	ref_buyers	Ссылка на владельца / покупателя		Контрагенты.Ссылка							
address	Адрес		Адрес									
phone	Телефон		Телефон									
vatstatus			Плательщик НДС									
juridical	ЮрЛицо		Признак юридического лица									
inn	ИНН		ИНН									
kpp	КПП		КПП									
bank	*БанкРеквизиты		Банковские реквизиты									
okpo	ОКПО		ОКПО									
												
												
Типы торговых точек												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
name	ПолноеНаименование		Наименование		"ВЫБРАТЬ
	Контрагенты.Ссылка КАК Ссылка,
	Контрагенты.Код,
	Контрагенты.ЭтоГруппа,
	Контрагенты.ПометкаУдаления
ИЗ
	Справочник.Контрагенты КАК Контрагенты
<ГДЕ ?>
ИТОГИ ПО
	Ссылка ТОЛЬКО ИЕРАРХИЯ"	0	"//полные имена групп
лОбъекты.Колонки.Добавить(""ПолноеНаименование"");
колстр = лОбъекты.Количество();
Для Инд=1 По колстр Цикл
	стрДоп=лОбъекты.Получить(колстр-Инд);
	Если ЗначениеЗаполнено(стрДоп.Ссылка) Тогда
		Если стрДоп.ЭтоГруппа Тогда
			стрДоп.ПолноеНаименование = стрДоп.Ссылка.ПолноеНаименование();
		Иначе
			лОбъекты.Удалить(стрДоп);
		КонецЕсли;
	Иначе
		лОбъекты.Удалить(стрДоп);
	КонецЕсли;
КонецЦикла;
лОбъекты.Свернуть(""Ссылка,ПолноеНаименование,Код,ПометкаУдаления"");
лОбъекты.Сортировать(""ПолноеНаименование"");"					
printcode	Код		Код объекта									
deleted	ПометкаУдаления		Пометка на удаление									
	#	ref_buyers			Контрагенты.Ссылка							
												
												
Торговые точки												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
name	Наименование		Наименование		"ВЫБРАТЬ РАЗЛИЧНЫЕ
	Партнеры.Ссылка КАК Ссылка,
	Партнеры.Код КАК Код,
	Партнеры.Наименование КАК Наименование,
	Партнеры.ПометкаУдаления КАК ПометкаУдаления,
	Партнеры.НаименованиеПолное КАК НаименованиеПолное,
	Контрагенты.Ссылка КАК Покупатель
ИЗ
	Справочник.Контрагенты КАК Контрагенты
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Партнеры КАК Партнеры
		ПО Контрагенты.Партнер = Партнеры.Ссылка
ГДЕ
	Партнеры.Клиент = ИСТИНА"	1	"//дополняем список

лОбъекты.Сортировать(""Ссылка Возр""); // сортируем по партнерам
лОбъекты.Колонки.Добавить(""Адрес"");
лОбъекты.Колонки.Добавить(""Телефон"");
											
// второй запрос, ищем детей найденных партнеров
Запрос2 = Новый Запрос;
Запрос2.Текст=
""ВЫБРАТЬ РАЗЛИЧНЫЕ
|	Партнеры.Ссылка КАК Ссылка,
|	Партнеры.Родитель,
|	МАКСИМУМ(ПартнерАдрес.Представление) КАК Адрес,
|	МАКСИМУМ(ПартнерТелефон.Представление) КАК Телефон,
|	Партнеры.Код КАК Код,
|	Партнеры.Наименование КАК Наименование,
|	Партнеры.ПометкаУдаления КАК ПометкаУдаления,
|	Партнеры.НаименованиеПолное КАК НаименованиеПолное,
|	Контрагенты.Ссылка КАК Покупатель
|ИЗ
|	Справочник.Партнеры КАК Партнеры
|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты КАК Контрагенты
|		ПО (Контрагенты.Партнер = Партнеры.Ссылка)
|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Партнеры.КонтактнаяИнформация КАК ПартнерАдрес
|		ПО (ПартнерАдрес.Ссылка = Партнеры.Ссылка)
|			И (ПартнерАдрес.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.АдресПартнера))
|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Партнеры.КонтактнаяИнформация КАК ПартнерТелефон
|		ПО (ПартнерТелефон.Ссылка = Партнеры.Ссылка)
|			И (ПартнерТелефон.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ТелефонПартнера))
|ГДЕ
|	Партнеры.Ссылка В ИЕРАРХИИ(&спПартнеры)
|	И Партнеры.Клиент = ИСТИНА
|
|СГРУППИРОВАТЬ ПО
|	Партнеры.Ссылка,
|	Контрагенты.Ссылка,
|	Партнеры.Родитель"";
Запрос2.УстановитьПараметр(""спПартнеры"", лОбъекты.ВыгрузитьКолонку(""Ссылка""));

тзн = Запрос2.Выполнить().Выгрузить();
тзн.Сортировать(""Ссылка Возр""); // сортируем по партнерам

лПоискАдрес = Новый Структура(""Ссылка,Покупатель"");
лПоискТТ = Новый Структура(""Родитель,Покупатель"");
лПоискТТ.Вставить(""Покупатель"", Null);

колСтр = лОбъекты.Количество();
Для инд=1 По колСтр Цикл
	стрПартнер = лОбъекты.Получить(инд-1);
	
	лПоискАдрес.Вставить(""Ссылка"", стрПартнер.Ссылка);
	лПоискАдрес.Вставить(""Покупатель"", стрПартнер.Покупатель);
	мстр = тзн.НайтиСтроки(лПоискАдрес);
	Если мстр.Количество()=0 Тогда
		СообщитьПодробно(""Упс, не найдено адресных записей по ""+стрПартнер.Ссылка, СтатусСообщения.Важное, Истина, ЗаписьВЖурнал);
		Продолжить;
	Иначе
		стрТТ = мстр[0];

		стрПартнер.Адрес = стрТТ.Адрес;
		стрПартнер.Телефон = стрТТ.Телефон;
		
		лПоискТТ.Вставить(""Родитель"", стрПартнер.Ссылка);
		ОбработатьПодчиненныхПартнеров_11(лОбъекты, тзн, лПоискТТ, стрТТ.Покупатель);
	КонецЕсли;
КонецЦикла;

лКонстанты.Вставить(""ПартнерКонтрагент"",лОбъекты.Скопировать(,""Ссылка,Покупатель""));"					
printcode	Код		Код объекта									
deleted	ПометкаУдаления		Пометка на удаление									
buyer	Покупатель	ref_buyers	Ссылка на владельца / покупателя		Контрагенты.Ссылка							
store		*ref_stores	Ссылка на склад отгрузки									
pricetype	*ТипЦен	*ref_pricetypes	Ссылка на тип цен		Контрагенты.ОсновнойДоговорКонтрагента.ТипЦен							
buypointtype	*Родитель	*ref_buypointtypes	Ссылка на тип торговой точки									
fullname	НаименованиеПолное		Полное наименование									
address	Адрес		Адрес									
phone	Телефон		Телефон									
contact	*КонтактноеЛицо		Контактное лицо									
vatstatus			Плательщик НДС									
canexceedlimit	*КонтролироватьЧислоДнейЗадолженности		Признак разрешения превышать срок кредита									
creditlimit	*ДопустимаяСуммаЗадолженности		Ограничение суммы кредита в основной валюте									
creditdeadline	*ДопустимоеЧислоДнейЗадолженности		Ограничение глубины кредита в днях									
maxorderamount			Ограничение максимальной сумма заказа									
minorderamount			Ограничение минимальной сумма заказа									
maxdiscount			Ограничение максимального процента скидки									
mindiscount			Ограничение минимального процента скидки									
extrarate			Процент наценки / скидки									
												
												
Договора												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
name	Наименование		Наименование		"ВЫБРАТЬ
	СоглашенияСКлиентами.Ссылка,
	СоглашенияСКлиентами.Наименование,
	СоглашенияСКлиентами.Номер,
	СоглашенияСКлиентами.ДатаНачалаДействия,
	СоглашенияСКлиентами.ДатаОкончанияДействия,
	ВЫБОР
		КОГДА СоглашенияСКлиентами.Организация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
			ТОГДА Организации.Ссылка
		ИНАЧЕ СоглашенияСКлиентами.Организация
	КОНЕЦ КАК Организация,
	СоглашенияСКлиентами.Контрагент,
	ВЫБОР
		КОГДА СоглашенияСКлиентами.Партнер = ЗНАЧЕНИЕ(Справочник.Партнеры.ПустаяСсылка)
			ТОГДА ВЫБОР
					КОГДА СоглашенияСКлиентами.СегментПартнеров = ЗНАЧЕНИЕ(Справочник.СегментыПартнеров.ПустаяСсылка)
						ТОГДА Партнеры.Ссылка
					ИНАЧЕ ПартнерыСегмента.Партнер
				КОНЕЦ
		ИНАЧЕ СоглашенияСКлиентами.Партнер
	КОНЕЦ КАК Партнер,
	СоглашенияСКлиентами.СегментПартнеров,
	СоглашенияСКлиентами.ВидЦен,
	СоглашенияСКлиентами.ПометкаУдаления
ПОМЕСТИТЬ ВТ
ИЗ
	Справочник.СоглашенияСКлиентами КАК СоглашенияСКлиентами
		ПОЛНОЕ СОЕДИНЕНИЕ Справочник.Организации КАК Организации
		ПО (СоглашенияСКлиентами.Организация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка))
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПартнерыСегмента КАК ПартнерыСегмента
		ПО СоглашенияСКлиентами.СегментПартнеров = ПартнерыСегмента.Сегмент
		ПОЛНОЕ СОЕДИНЕНИЕ Справочник.Партнеры КАК Партнеры
		ПО (СоглашенияСКлиентами.Партнер = ЗНАЧЕНИЕ(Справочник.Партнеры.ПустаяСсылка))
			И (СоглашенияСКлиентами.СегментПартнеров = ЗНАЧЕНИЕ(Справочник.СегментыПартнеров.ПустаяСсылка))
ГДЕ
	СоглашенияСКлиентами.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыСоглашенийСКлиентами.Действует)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ.Ссылка,
	ВТ.Наименование,
	ВТ.Номер,
	ВТ.ДатаНачалаДействия,
	ВТ.ДатаОкончанияДействия,
	ВТ.Организация,
	ВТ.Контрагент,
	ВТ.Партнер,
	ВТ.СегментПартнеров,
	ВТ.ВидЦен,
	ВТ.ПометкаУдаления
ИЗ
	ВТ КАК ВТ"	0	"// подстановка контрагентов
Запрос2 = Новый Запрос;
Запрос2.Текст = 
""ВЫБРАТЬ
|	Соглашения.Ссылка,
|	Соглашения.Наименование,
|	Соглашения.Номер,
|	Соглашения.Организация,
|	Соглашения.Контрагент,
|	Соглашения.Партнер,
|	Соглашения.СегментПартнеров,
|	Соглашения.ВидЦен,
|	Соглашения.ДатаНачалаДействия,
|	Соглашения.ДатаОкончанияДействия,
|	Соглашения.ПометкаУдаления
|ПОМЕСТИТЬ Соглашения
|ИЗ
|	&Соглашения КАК Соглашения
|;
|
|////////////////////////////////////////////////////////////////////////////////
|ВЫБРАТЬ
|	ПартнерКонтрагент.Ссылка,
|	ПартнерКонтрагент.Покупатель
|ПОМЕСТИТЬ ПартнерКонтрагент
|ИЗ
|	&ПартнерКонтрагент КАК ПартнерКонтрагент
|;
|
|////////////////////////////////////////////////////////////////////////////////
|ВЫБРАТЬ
|	Соглашения.Ссылка,
|	Соглашения.Наименование,
|	Соглашения.Номер,
|	Соглашения.ПометкаУдаления,
|	Соглашения.Организация,
|	Соглашения.Партнер,
|	Соглашения.ВидЦен,
|	Соглашения.ДатаНачалаДействия,
|	Соглашения.ДатаОкончанияДействия,
|	ПартнерКонтрагент.Покупатель КАК Контрагент
|ПОМЕСТИТЬ ВТ
|ИЗ
|	Соглашения КАК Соглашения
|		ЛЕВОЕ СОЕДИНЕНИЕ ПартнерКонтрагент КАК ПартнерКонтрагент
|		ПО Соглашения.Партнер = ПартнерКонтрагент.Ссылка
|;
|
|////////////////////////////////////////////////////////////////////////////////
|ВЫБРАТЬ РАЗЛИЧНЫЕ
|	ВТ.Ссылка КАК Соглашение,
|	ВТ.Наименование,
|	ВТ.ПометкаУдаления,
|	ВТ.Организация,
|	ВТ.ВидЦен,
|	ВТ.ДатаНачалаДействия,
|	ВТ.ДатаОкончанияДействия,
|	ВТ.Партнер,
|	ВТ.Контрагент
|ИЗ
|	ВТ КАК ВТ
|ГДЕ
|	ВТ.Контрагент <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)"";
Запрос2.УстановитьПараметр(""Соглашения"",лОбъекты);
Запрос2.УстановитьПараметр(""ПартнерКонтрагент"",лКонстанты.ПартнерКонтрагент);

лОбъекты = Запрос2.Выполнить().Выгрузить();
лАвтоИдентификатор = Ложь;

лТмпТЗ = лОбъекты.Скопировать(,""Соглашение"");
лТмпТЗ.Свернуть(""Соглашение"");
стрСФ = лСписокФильтров.Добавить();
стрСФ.ИмяРаздела = лИмяРаздела;
стрСФ.Отбор = лТмпТЗ.ВыгрузитьКолонку(""Соглашение"");

// данные для формирования sid
лОбъекты.Колонки.Добавить(""Ссылка"");
Для Каждого стрДоп Из лОбъекты Цикл
	стрДоп.Ссылка = """"+XMLСтрока(стрДоп.Соглашение)+""***""+XMLСтрока(стрДоп.Контрагент);
КонецЦикла;

лКонстанты.Вставить(""ДоговорПартнер"",лОбъекты.Скопировать(,""Ссылка,Соглашение,Партнер""));"					
printcode	*Код		Код объекта									
deleted	ПометкаУдаления		Пометка на удаление									
firm	Организация	ref_firms	Ссылка на собственную фирму		ВТ.Организация							
counteragent	Контрагент	*ref_counteragents	Ссылка на контрагента / юр. лицо / покупателя		ВТ.Контрагент							
pricetype	ВидЦен	*ref_pricetypes	Ссылка на тип цен		ВТ.ВидЦен							
startdate	ДатаНачалаДействия		Дата начала действия договора									
enddate	ДатаОкончанияДействия		Дата окончания действия договора									
canexceedlimit	*КонтролироватьЧислоДнейЗадолженности		Признак разрешения превышать срок кредита									
creditlimit	*ДопустимаяСуммаЗадолженности		Ограничение суммы кредита в основной валюте									
creditdeadline	*ДопустимоеЧислоДнейЗадолженности		Ограничение глубины кредита в днях									
maxorderamount			Ограничение максимальной сумма заказа									
minorderamount			Ограничение минимальной сумма заказа									
maxdiscount			Ограничение максимального процента скидки									
mindiscount			Ограничение минимального процента скидки									
	#	ref_buypoints			ВТ.Партнер							
												
												
Обслуживаемые по договору ТТ												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
deleted	*ПометкаУдаления		Пометка на удаление		"ВЫБРАТЬ
	1 КАК Поле1"	0	"// выгрузка

лОбъекты = лКонстанты.ДоговорПартнер;
лОбъекты.Свернуть(""Ссылка,Партнер"");"					
agreement	Ссылка	ref_agreements	Ссылка на договор		НЕОПРЕДЕЛЕНО							
buypoint	Партнер	ref_buypoints	Ссылка на торговую точку		НЕОПРЕДЕЛЕНО							
default	*ОсновнойДоговор		Признак основного договора									
												
												
Территории агентов												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
deleted					"ВЫБРАТЬ
	Партнеры.Ссылка КАК Партнер,
	Партнеры.ОсновнойМенеджер КАК Сотрудник
ИЗ
	Справочник.Партнеры КАК Партнеры"	0	"// данные для формирования sid

лОбъекты.Колонки.Добавить(""Ссылка"");
Для Каждого стрДоп Из лОбъекты Цикл
	стрДоп.Ссылка = """"+XMLСтрока(стрДоп.Сотрудник)+""***""+XMLСтрока(стрДоп.Партнер);
КонецЦикла;"					
employee	Сотрудник	ref_employees	Ссылка на сотрудника		Партнеры.ОсновнойМенеджер							
buypoint	Партнер	ref_buypoints	Ссылка на торговую точку		Партнеры.Ссылка							
												
												
Товарные группы												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
name	Наименование		Наименование		"ВЫБРАТЬ
	Номенклатура.Ссылка КАК Ссылка,
	Номенклатура.Наименование,
	Номенклатура.Код,
	Номенклатура.ПометкаУдаления,
	Номенклатура.ЭтоГруппа,
	Номенклатура.Родитель
ИЗ
	Справочник.Номенклатура КАК Номенклатура
<ГДЕ ?>
УПОРЯДОЧИТЬ ПО
	Ссылка
ИТОГИ ПО
	Ссылка ТОЛЬКО ИЕРАРХИЯ"	0	"// выборка до верхнего уровня и сортировка
лОбъекты.Колонки.Добавить(""Представление"");
колстр = лОбъекты.Количество();
Для Инд=1 По колстр Цикл
	стрДоп=лОбъекты.Получить(колстр-Инд);
	Если ЗначениеЗаполнено(стрДоп.Ссылка) Тогда
		Если стрДоп.ЭтоГруппа Тогда
			стрДоп.Представление = стрДоп.Ссылка.ПолноеНаименование();
		Иначе
			лОбъекты.Удалить(стрДоп);
		КонецЕсли;
	Иначе
		лОбъекты.Удалить(стрДоп);
	КонецЕсли;
КонецЦикла;
лОбъекты.Свернуть(""Ссылка,Представление,Наименование,Код,ПометкаУдаления,Родитель"");
лОбъекты.Сортировать(""Представление"");"				"// выборка до верхнего уровня и сортировка
лОбъекты.Колонки.Добавить(""Представление"");
Для Каждого стрДоп Из лОбъекты Цикл
	стрДоп.Представление = стрДоп.Ссылка.ПолноеНаименование();
КонецЦикла;
лОбъекты.Сортировать(""Представление"");"	
printcode	Код		Код объекта									
deleted	ПометкаУдаления		Пометка на удаление									
parentskugroup	Родитель	*ref_skugroups	Ссылка на родительскую группу									
sequence			Сортировка									
	*#	ref_skus			Номенклатура.Ссылка							
												
												
Товары												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
name	Наименование		Наименование		"ВЫБРАТЬ
	Номенклатура.Ссылка,
	Номенклатура.Наименование,
	Номенклатура.Код,
	ВЫБОР
		КОГДА (ВЫРАЗИТЬ(Номенклатура.Артикул КАК СТРОКА(25))) = """"
			ТОГДА ""--""
		ИНАЧЕ Номенклатура.Артикул
	КОНЕЦ КАК Артикул,
	Номенклатура.ПометкаУдаления,
	Номенклатура.Родитель,
	Номенклатура.ЕдиницаИзмерения,
	Номенклатура.НаименованиеПолное,
//	Номенклатура.Весовой,
	ВЫБОР
		КОГДА Номенклатура.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС18)
			ТОГДА 0.18
		ИНАЧЕ ВЫБОР
				КОГДА Номенклатура.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС10)
					ТОГДА 0.1
					ИНАЧЕ 0
			КОНЕЦ
	КОНЕЦ КАК СтавкаНДС,
	1 КАК merchandising,
	1 КАК countable
ИЗ
	Справочник.Номенклатура КАК Номенклатура
ГДЕ
	Номенклатура.ЭтоГруппа = ЛОЖЬ
	И Номенклатура.ЕдиницаИзмерения<>Значение(Справочник.ЕдиницыИзмерения.ПустаяСсылка)"	1						
printcode	Артикул		Код объекта									
deleted	ПометкаУдаления		Пометка на удаление									
skugroup	Родитель	ref_skugroups	Ссылка на товарную группу		Номенклатура.Родитель							
unit	ЕдиницаИзмерения	*ref_units	Ссылка на единицу измерения									
fullname	НаименованиеПолное		Полное наименование									
weight			Вес единицы измерения									
canweight	*Весовой		Признак весового товара									
sequence			Сортировка									
vatrate	СтавкаНДС		Процент ставки НДС									
merchandising	merchandising		Отметка об инструменте мерчандайзинга									
countable	countable		Отметка о количественном учете наличия при мерчандайзинге									
												
												
Единицы измерения товаров												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
printcode			Штрих-код		"ВЫБРАТЬ
	Номенклатура.Ссылка КАК Номенклатура,
	Номенклатура.ЕдиницаИзмерения,
	Номенклатура.НаборУпаковок,
	Номенклатура.ИспользоватьУпаковки
ПОМЕСТИТЬ ВТ
ИЗ
	Справочник.Номенклатура КАК Номенклатура
ГДЕ
	Номенклатура.ЭтоГруппа = ЛОЖЬ
	И Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Товар)
	<ГДЕ ?>
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ.Номенклатура КАК Номенклатура,
	ВТ.ЕдиницаИзмерения,
	1 КАК Коэффициент
ИЗ
	ВТ КАК ВТ
ГДЕ
	ВТ.ИспользоватьУпаковки = ЛОЖЬ

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	УпаковкиНоменклатуры.Владелец,
	УпаковкиНоменклатуры.ЕдиницаИзмерения,
	УпаковкиНоменклатуры.Коэффициент
ИЗ
	Справочник.УпаковкиНоменклатуры КАК УпаковкиНоменклатуры
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ КАК ВТ
		ПО УпаковкиНоменклатуры.Владелец = ВТ.Номенклатура
ГДЕ
	ВТ.ИспользоватьУпаковки = ИСТИНА
	И ВТ.НаборУпаковок = ЗНАЧЕНИЕ(Справочник.НаборыУпаковок.ИндивидуальныйДляНоменклатуры)

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ.Номенклатура,
	УпаковкиНоменклатуры.ЕдиницаИзмерения,
	УпаковкиНоменклатуры.Коэффициент
ИЗ
	Справочник.УпаковкиНоменклатуры КАК УпаковкиНоменклатуры
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ КАК ВТ
		ПО УпаковкиНоменклатуры.Владелец = ВТ.НаборУпаковок
ГДЕ
	ВТ.ИспользоватьУпаковки = ИСТИНА
	И ВТ.НаборУпаковок <> ЗНАЧЕНИЕ(Справочник.НаборыУпаковок.ИндивидуальныйДляНоменклатуры)

ОБЪЕДИНИТЬ

ВЫБРАТЬ
	ВТ.Номенклатура,
	ВТ.ЕдиницаИзмерения,
	1
ИЗ
	ВТ КАК ВТ
ГДЕ
	ВТ.ИспользоватьУпаковки = ИСТИНА

УПОРЯДОЧИТЬ ПО
	Номенклатура"	1				"// данные для формирования sid
лОбъекты.Колонки.Добавить(""Ссылка"");
Для Каждого стрДоп Из лОбъекты Цикл
	стрДоп.Ссылка = """"+XMLСтрока(стрДоп.Номенклатура)+""***""+XMLСтрока(стрДоп.ЕдиницаИзмерения);
КонецЦикла;"		
deleted	*ПометкаУдаления		Пометка на удаление									
sku	Номенклатура	ref_skus	Ссылка на товар		Номенклатура.Ссылка							
unit	ЕдиницаИзмерения	*ref_units	Ссылка на единицу измерения									
factor	Коэффициент		Коэффициент пересчета в базовую единицу измерения									
weight	*Вес		Вес единицы измерения (не используется)									
												
												
Изображения товаров												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
deleted	ПометкаУдаления				"ВЫБРАТЬ
	ХранилищеДополнительнойИнформации.Ссылка КАК Идентификатор,
	ХранилищеДополнительнойИнформации.ПометкаУдаления,
	ВЫБОР
		КОГДА ХранилищеДополнительнойИнформации.Объект.ОсновноеИзображение = ХранилищеДополнительнойИнформации.Ссылка
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК ОсновноеИзображение,
	ХранилищеДополнительнойИнформации.Объект,
	ХранилищеДополнительнойИнформации.Хранилище
ИЗ
	Справочник.ХранилищеДополнительнойИнформации КАК ХранилищеДополнительнойИнформации
ГДЕ
	ХранилищеДополнительнойИнформации.ВидДанных = ЗНАЧЕНИЕ(Перечисление.ВидыДополнительнойИнформацииОбъектов.Изображение)"	1	"// айдишники фоток и выгрузка на фотохостинг

лОбщийРазмер = 0;

лОбъекты.Колонки.Добавить(""ИдентификаторФото"");
Для Каждого стрДоп Из лОбъекты Цикл
	стрДоп.ИдентификаторФото = ""DEFAULT-""+XMLСтрока(стрДоп.Идентификатор);
	
	лРазмер = ВыгрузитьФото(стрДоп.Хранилище, стрДоп.ИдентификаторФото);
	Если лРазмер=0 Тогда
		стрДоп.ИдентификаторФото="""";
	Иначе
		лОбщийРазмер = лОбщийРазмер+лРазмер;
	КонецЕсли;
КонецЦикла;

Сообщить(""Всего отправлено ""+лОбщийРазмер+"" байт"");"					
sku	Объект	ref_skus	Ссылка на товар		ХранилищеДополнительнойИнформации.Объект							
isdefault	ОсновноеИзображение		Основное изображение									
image	ИдентификаторФото		Фотография товара									
												
												
Остатки товаров												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
deleted			Пометка на удаление		"ВЫБРАТЬ
	График.Номенклатура КАК Номенклатура,
	График.Склад КАК Склад,
	-МИНИМУМ(График.КоличествоКонечныйОстаток) КАК Количество
ПОМЕСТИТЬ ВтРезервыПоГрафику
ИЗ
	РегистрНакопления.ГрафикДвиженияТоваров.ОстаткиИОбороты({(КОНЕЦПЕРИОДА(&ДатаФормирования, ДЕНЬ)) КАК Поле2}, {(КОНЕЦПЕРИОДА(&ДатаФормирования, ДЕНЬ)) КАК Поле2}, День, ДвиженияИГраницыПериода, Склад.ВариантКонтроля = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроля.ОстаткиСУчетомГрафика) {(Номенклатура).* КАК Номенклатура, (Склад).* КАК Склад, (Характеристика).* КАК Характеристика}) КАК График
ГДЕ
	ВЫБОР
			КОГДА График.Склад.ГраницаГрафикаДоступности >= &ДатаФормирования
				ТОГДА График.Период <= График.Склад.ГраницаГрафикаДоступности
			КОГДА График.Склад.СрокПоставки > 0
				ТОГДА График.Период <= ДОБАВИТЬКДАТЕ(&ДатаФормирования, ДЕНЬ, График.Склад.СрокПоставки)
			ИНАЧЕ ЛОЖЬ
		КОНЕЦ
	И График.КоличествоКонечныйОстаток < 0

СГРУППИРОВАТЬ ПО
	График.Номенклатура,
	График.Склад

ИНДЕКСИРОВАТЬ ПО
	Номенклатура,
	Склад
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СвободныеОстатки.Номенклатура КАК Номенклатура,
	СвободныеОстатки.Склад КАК Склад,
	СвободныеОстатки.ВНаличииОстаток КАК ВНаличии,
	ВЫБОР
		КОГДА СвободныеОстатки.Склад.ВариантКонтроля = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроля.ОстаткиСУчетомРезерва)
			ТОГДА СвободныеОстатки.ВРезервеОстаток
		КОГДА СвободныеОстатки.Склад.ВариантКонтроля = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроля.ОстаткиСУчетомГрафика)
			ТОГДА ЕСТЬNULL(РезервыПоГрафику.Количество, 0)
		ИНАЧЕ 0
	КОНЕЦ КАК Резерв,
	СвободныеОстатки.ВНаличииОстаток - ВЫБОР
		КОГДА СвободныеОстатки.Склад.ВариантКонтроля = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроля.ОстаткиСУчетомРезерва)
			ТОГДА СвободныеОстатки.ВРезервеОстаток
		КОГДА СвободныеОстатки.Склад.ВариантКонтроля = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроля.ОстаткиСУчетомГрафика)
			ТОГДА ЕСТЬNULL(РезервыПоГрафику.Количество, 0)
		ИНАЧЕ 0
	КОНЕЦ КАК Свободно
ИЗ
	РегистрНакопления.СвободныеОстатки.Остатки(, {(Номенклатура).* КАК Номенклатура, (Склад).* КАК Склад}) КАК СвободныеОстатки
		ЛЕВОЕ СОЕДИНЕНИЕ ВтРезервыПоГрафику КАК РезервыПоГрафику
		ПО СвободныеОстатки.Номенклатура = РезервыПоГрафику.Номенклатура
			И СвободныеОстатки.Склад = РезервыПоГрафику.Склад
			И (СвободныеОстатки.Склад.ВариантКонтроля = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроля.ОстаткиСУчетомГрафика))
ГДЕ
	(СвободныеОстатки.ВНаличииОстаток <> 0
			ИЛИ ВЫБОР
				КОГДА СвободныеОстатки.Склад.ВариантКонтроля = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроля.ОстаткиСУчетомРезерва)
					ТОГДА СвободныеОстатки.ВРезервеОстаток
				КОГДА СвободныеОстатки.Склад.ВариантКонтроля = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроля.ОстаткиСУчетомГрафика)
					ТОГДА ЕСТЬNULL(РезервыПоГрафику.Количество, 0)
				ИНАЧЕ 0
			КОНЕЦ <> 0)"	1						
sku	Номенклатура	ref_skus	Ссылка на товар		СвободныеОстатки.Номенклатура							
store	Склад	ref_stores	Ссылка на склад		СвободныеОстатки.Склад							
firm		ref_firms	Ссылка на собственную фирму									
quantity	Свободно		Количество									
reserved			Х									
												
												
Задолженности												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
deleted			Пометка на удаление		"ВЫБРАТЬ
	ПроведениеПоРасчетамСКлиентами.АналитикаУчетаПоПартнерам КАК АналитикаУчетаПоПартнерам,
	МИНИМУМ(ПроведениеПоРасчетамСКлиентами.Период) КАК Период
ПОМЕСТИТЬ НачальныеДвижения
ИЗ
	Последовательность.ПроведениеПоРасчетамСКлиентами КАК ПроведениеПоРасчетамСКлиентами
ГДЕ
	ПроведениеПоРасчетамСКлиентами.АналитикаУчетаПоПартнерам.Организация В(&Отбор_ref_firms)
	И ПроведениеПоРасчетамСКлиентами.АналитикаУчетаПоПартнерам.Партнер В(&Отбор_ref_buypoints)

СГРУППИРОВАТЬ ПО
	ПроведениеПоРасчетамСКлиентами.АналитикаУчетаПоПартнерам
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Границы.АналитикаУчетаПоПартнерам КАК АналитикаУчетаПоПартнерам,
	МАКСИМУМ(ДОБАВИТЬКДАТЕ(Границы.АктуальныйПериод, ДЕНЬ, -1)) КАК АктуальныйПериод,
	ИСТИНА КАК РасчетыНеактуальны
ПОМЕСТИТЬ Границы
ИЗ
	(ВЫБРАТЬ
		НачальныеДвижения.АналитикаУчетаПоПартнерам КАК АналитикаУчетаПоПартнерам,
		ЕСТЬNULL(ПроведениеПоРасчетамСКлиентамиГраницы.Период, НачальныеДвижения.Период) КАК АктуальныйПериод
	ИЗ
		НачальныеДвижения КАК НачальныеДвижения
			ЛЕВОЕ СОЕДИНЕНИЕ Последовательность.ПроведениеПоРасчетамСКлиентами.Границы КАК ПроведениеПоРасчетамСКлиентамиГраницы
			ПО НачальныеДвижения.АналитикаУчетаПоПартнерам = ПроведениеПоРасчетамСКлиентамиГраницы.АналитикаУчетаПоПартнерам) КАК Границы
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РасчетыСКлиентами КАК РасчетыСКлиентами
		ПО Границы.АналитикаУчетаПоПартнерам = РасчетыСКлиентами.АналитикаУчетаПоПартнерам

СГРУППИРОВАТЬ ПО
	Границы.АналитикаУчетаПоПартнерам

ИМЕЮЩИЕ
	МАКСИМУМ(Границы.АктуальныйПериод) <= МАКСИМУМ(РасчетыСКлиентами.Период)

ИНДЕКСИРОВАТЬ ПО
	АналитикаУчетаПоПартнерам
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	РасчетыСКлиентами.АналитикаУчетаПоПартнерам,
	РасчетыСКлиентами.ЗаказКлиента,
	РасчетыСКлиентами.Валюта,
	РасчетыСКлиентамиПоДокументам.РасчетныйДокумент,
	РасчетыСКлиентамиПоДокументам.ДатаПлатежа,
	ВЫБОР
		КОГДА НЕ Границы.РасчетыНеактуальны ЕСТЬ NULL 
			ТОГДА ВЫБОР
					КОГДА РасчетыСКлиентами.СуммаОстаток < 0
						ТОГДА -РасчетыСКлиентами.СуммаОстаток
					ИНАЧЕ 0
				КОНЕЦ
		ИНАЧЕ -(РасчетыСКлиентамиПоДокументам.КВозвратуОстаток + РасчетыСКлиентамиПоДокументам.ПредоплатаОстаток)
	КОНЕЦ КАК НашДолг,
	ВЫБОР
		КОГДА НЕ Границы.РасчетыНеактуальны ЕСТЬ NULL 
			ТОГДА ВЫБОР
					КОГДА РасчетыСКлиентами.СуммаОстаток > 0
						ТОГДА РасчетыСКлиентами.СуммаОстаток
					ИНАЧЕ 0
				КОНЕЦ
		ИНАЧЕ РасчетыСКлиентамиПоДокументам.ДолгОстаток
	КОНЕЦ КАК ДолгКлиента,
	АналитикаУчета.Партнер,
	АналитикаУчета.Организация,
	АналитикаУчета.Контрагент
ПОМЕСТИТЬ ТаблицаЗадолженностей
ИЗ
	РегистрНакопления.РасчетыСКлиентами.Остатки(КОНЕЦПЕРИОДА(&ДатаФормирования, ДЕНЬ), ) КАК РасчетыСКлиентами
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РасчетыСКлиентамиПоДокументам.Остатки(КОНЕЦПЕРИОДА(&ДатаФормирования, ДЕНЬ), ) КАК РасчетыСКлиентамиПоДокументам
		ПО РасчетыСКлиентами.АналитикаУчетаПоПартнерам = РасчетыСКлиентамиПоДокументам.АналитикаУчетаПоПартнерам
			И РасчетыСКлиентами.ЗаказКлиента = РасчетыСКлиентамиПоДокументам.ЗаказКлиента
			И РасчетыСКлиентами.Валюта = РасчетыСКлиентамиПоДокументам.Валюта
		ЛЕВОЕ СОЕДИНЕНИЕ Границы КАК Границы
		ПО РасчетыСКлиентами.АналитикаУчетаПоПартнерам = Границы.АналитикаУчетаПоПартнерам
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаПоПартнерам КАК АналитикаУчета
		ПО РасчетыСКлиентами.АналитикаУчетаПоПартнерам = АналитикаУчета.КлючАналитики
ГДЕ
	АналитикаУчета.Партнер <> ЗНАЧЕНИЕ(Справочник.Партнеры.НашеПредприятие)
	И АналитикаУчета.Организация В(&Отбор_ref_firms)
	И АналитикаУчета.Партнер В(&Отбор_ref_buypoints)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаЗадолженностей.АналитикаУчетаПоПартнерам,
	ТаблицаЗадолженностей.ЗаказКлиента,
	ТаблицаЗадолженностей.Валюта,
	ТаблицаЗадолженностей.РасчетныйДокумент,
	ТаблицаЗадолженностей.РасчетныйДокумент.Номер КАК РасчетныйДокументНомер,
	ТаблицаЗадолженностей.РасчетныйДокумент.Дата КАК РасчетныйДокументДата,
	ТаблицаЗадолженностей.Партнер,
	ТаблицаЗадолженностей.Организация,
	ТаблицаЗадолженностей.Контрагент,
	ТаблицаЗадолженностей.НашДолг,
	ТаблицаЗадолженностей.ДолгКлиента
ИЗ
	ТаблицаЗадолженностей КАК ТаблицаЗадолженностей
ГДЕ
	ТаблицаЗадолженностей.ДолгКлиента > 0"	0	"// обработка документов в ссылках
лОбъекты.Свернуть(""Партнер, Контрагент, Валюта, Организация, РасчетныйДокумент"",""ДолгКлиента, НашДолг"");

лОбъекты.Колонки.Добавить(""ДокументПредставление"");
лОбъекты.Колонки.Добавить(""Дата"");
лОбъекты.Колонки.Добавить(""Долг"");

Для Каждого стрДоп Из лОбъекты Цикл
	Если ЗначениеЗаполнено(стрДоп.РасчетныйДокумент) Тогда
		стрДоп.ДокументПредставление = стрДоп.РасчетныйДокумент.Метаданные().Имя + "" №"" +  стрДоп.РасчетныйДокумент.Номер + "" от "" +стрДоп.РасчетныйДокумент.Дата;
		стрДоп.Дата = стрДоп.РасчетныйДокумент.Дата;
	Иначе
		стрДоп.ДокументПредставление = ""--"";
		стрДоп.Дата = лДатаОбмена;
	КонецЕсли;
	//стрДоп.Долг = ?(ЗначениеЗаполнено(стрДоп.ДолгКлиента), стрДоп.ДолгКлиента, -стрДоп.НашДолг);
	стрДоп.Долг = стрДоп.ДолгКлиента-стрДоп.НашДолг;
КонецЦикла;"					
buyer	Контрагент	*ref_buyers	Ссылка на владельца / покупателя									
counteragent	Контрагент	*ref_counteragents	Ссылка на контрагента / юр. лицо									
buypoint	Партнер	ref_buypoints	Ссылка на торговую точку		ПАРАМЕТР							
agreement	*ДоговорКонтрагента	*ref_agreements	Ссылка на договор									
firm	Организация	ref_firms	Ссылка на собственную фирму		ПАРАМЕТР							
invoice	*РасчетныйДокумент	*doc_invoices	Ссылка на документ отгрузки товара									
date	Дата		Дата возникновения задолженности									
amount	Долг		Сумма задолженности									
docinfo	ДокументПредставление		Описание документа задолженности									
												
												
Цены товаров												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
deleted			Пометка на удаление		"ВЫБРАТЬ РАЗЛИЧНЫЕ
	ЦеныНоменклатурыСрезПоследних.Номенклатура,
	ЦеныНоменклатурыСрезПоследних.ВидЦены,
	ЦеныНоменклатурыСрезПоследних.Валюта,
	ЦеныНоменклатурыСрезПоследних.Цена * КурсыВалютСрезПоследних.Курс КАК Цена,
	ЦеныНоменклатурыСрезПоследних.Номенклатура.ЕдиницаИзмерения КАК ЕдиницаИзмерения
//	ЦеныНоменклатурыСрезПоследних.Упаковка.ЕдиницаИзмерения КАК ЕдиницаИзмерения
ИЗ
	РегистрСведений.ЦеныНоменклатуры.СрезПоследних(&КонецПериода, ) КАК ЦеныНоменклатурыСрезПоследних
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КурсыВалют.СрезПоследних(&КонецПериода, ) КАК КурсыВалютСрезПоследних
		ПО ЦеныНоменклатурыСрезПоследних.Валюта = КурсыВалютСрезПоследних.Валюта
ГДЕ
	ЦеныНоменклатурыСрезПоследних.Цена <> 0
	И КурсыВалютСрезПоследних.Курс <> 0"	1						
sku	Номенклатура	ref_skus	Ссылка на товар		ЦеныНоменклатурыСрезПоследних.Номенклатура							
pricetype	ВидЦены	*ref_pricetypes	Ссылка на тип цены		ЦеныНоменклатурыСрезПоследних.ВидЦены							
unit	ЕдиницаИзмерения	*ref_units	Ссылка на единицу измерения		ЦеныНоменклатурыСрезПоследних.Упаковка.ЕдиницаИзмерения							
price	Цена		Цена									
	*#	ref_skuunits			ЦеныНоменклатурыСрезПоследних.Упаковка							
												
												
Статусы состояния документа												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
name	Наименование		Наименование		*	0						
printcode	Код		Код объекта									
deleted	ПометкаУдаления		Пометка на удаление									
												
												
Типы оплаты												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
name	Наименование		Наименование		*	0						
printcode	Код		Код объекта									
deleted	ПометкаУдаления		Пометка на удаление									
												
												
Продажи												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
datetime	Дата		Дата и время документа		"ВЫБРАТЬ
	РеализацияТоваровУслуг.Ссылка,
	РеализацияТоваровУслуг.Соглашение.ВидЦен КАК ВидЦен,
	РеализацияТоваровУслуг.Менеджер,
	РеализацияТоваровУслуг.Организация,
	РеализацияТоваровУслуг.Склад,
	РеализацияТоваровУслуг.Контрагент,
	РеализацияТоваровУслуг.Партнер,
	РеализацияТоваровУслуг.Соглашение,
	РеализацияТоваровУслуг.ПометкаУдаления,
	РеализацияТоваровУслуг.Проведен,
	РеализацияТоваровУслуг.Дата,
	РеализацияТоваровУслуг.Номер,
	РеализацияТоваровУслуг.Комментарий,
	ИСТИНА КАК УчитыватьНДС,
	РеализацияТоваровУслуг.ЦенаВключаетНДС,
	РеализацияТоваровУслуг.СуммаДокумента,
	РеализацияТоваровУслуг.Товары.(
		Номенклатура,
		Упаковка.ЕдиницаИзмерения КАК ЕдиницаИзмерения,
//		Коэффициент,
		Количество,
		ВЫБОР
			КОГДА РеализацияТоваровУслуг.Товары.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС18)
				ТОГДА 0.18
			ИНАЧЕ ВЫБОР
					КОГДА РеализацияТоваровУслуг.Товары.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС10)
						ТОГДА 0.1
						ИНАЧЕ 0
				КОНЕЦ
		КОНЕЦ КАК СтавкаНДС,
		ВидЦены,
		Цена
	) КАК Товары
ИЗ
	Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
ГДЕ
	РеализацияТоваровУслуг.Дата МЕЖДУ &НачалоПериода И &КонецПериода"	1						
printcode	Номер		Код объекта									
deleted	ПометкаУдаления		Пометка на удаление									
docstate		*ref_docstates	Ссылка на статус состояния документа									
pricetype	ВидЦен	*ref_pricetypes	Ссылка на тип цены		РеализацияТоваровУслуг.Соглашение.ВидЦен							
employee	*Менеджер	ref_employees	Ссылка на сотрудника									
firm	Организация	ref_firms	Ссылка на собственную фирму		РеализацияТоваровУслуг.Организация							
store	Склад	ref_stores	Ссылка на склад		РеализацияТоваровУслуг.Склад							
buyer	Контрагент	*ref_buyers	Ссылка на владельца / покупателя		РеализацияТоваровУслуг.Контрагент							
buypoint	Партнер	ref_buypoints	Ссылка на торговую точку		РеализацияТоваровУслуг.Партнер							
counteragent	Контрагент	*ref_counteragents	Ссылка на контрагента / юр. лицо / плательщика									
agreement	Соглашение	ref_agreements	Ссылка на договор		РеализацияТоваровУслуг.Соглашение							
paytype		*ref_paytypes	Ссылка на тип оплаты									
shipping			Фактическая дата и время отгрузки товара									
comment	Комментарий		Произвольный комментарий									
extrarate			Процент общей наценки / скидки на документ									
includevat	ЦенаВключаетНДС		НДС включен в сумму									
usevat	УчитыватьНДС		Учитывать НДС									
amount	СуммаДокумента		Сумма									
processed	Проведен		Признак проведения документа									
												
Продажи (ТЧ)												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
deleted			Пометка на удаление		Товары	Х						
sku	Номенклатура	ref_skus	Ссылка на товар		РеализацияТоваровУслуг.Товары.Номенклатура							
unit	ЕдиницаИзмерения	*ref_units	Ссылка на единицу измерения									
pricetype	ВидЦены	*ref_pricetypes	Ссылка на тип цены									
factor	*Коэффициент		Коэффициент пересчета в базовую единицу измерения									
quantity	Количество		Количество в выбранной единице измерения									
extrarate			Процент наценки / скидки									
vatrate	СтавкаНДС		Процент ставки НДС									
price	Цена		Цена за выбранную единицу измерения без учета скидок / наценок									
												
												
Заявки												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке	В конце загрузки док.			
					Х	Х		"// шапка
лПеременные.Вставить(""УчитыватьНДС"", Истина);
//лОбъект.ЦенаВключаетНДС = лОбъект.ВидЦены.ЦенаВключаетНДС;

лОбъект.Валюта = Константы.ВалютаРегламентированногоУчета.Получить();
лОбъект.НалогообложениеНДС	= ?(лПеременные.УчитыватьНДС, Перечисления.ТипыНалогообложенияНДС.ПродажаОблагаетсяНДС, Перечисления.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС);

//лОбъект.БанковскийСчет = лОбъект.Организация.ОсновнойБанковскийСчет;

лРегистрАдрес = лОбъект.Партнер.КонтактнаяИнформация.НайтиСтроки(новый Структура(""Вид"", Справочники.ВидыКонтактнойИнформации.АдресПартнера));
лОбъект.АдресДоставки = ?(лРегистрАдрес.Количество() > 0, СокрЛП(лРегистрАдрес[0].Представление), """");

лОбъект.СкидкиРассчитаны = Истина;

лОбъект.Статус = Перечисления.СтатусыЗаказовКлиентов.НеСогласован; 
лОбъект.Приоритет = Перечисления.Приоритеты.Средний;
лОбъект.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеализацияКлиенту;
//лОбъект.Менеджер = ПолучитьСотрудникаПоФизЛицу(лСотрудник);
лОбъект.Подразделение = лОбъект.Менеджер.ТекущееПодразделение;

лОбъект.УстановитьВремя(РежимАвтоВремя.ТекущееИлиПоследним);
//лОбъект.УстановитьНовыйНомер(лОбъект.Организация.Префикс);

Если ЗначениеЗаполнено(лОбъект.Соглашение) Тогда
	лОбъект.ЗаполнитьУсловияПродажПоCоглашению();
ИначеЕсли ЗначениеЗаполнено(лОбъект.Партнер) Тогда
	УсловияПродажПоУмолчанию = ПродажиСервер.ПолучитьУсловияПродажПоУмолчанию(лОбъект.Партнер, лОбъект.Дата);
	Если УсловияПродажПоУмолчанию <> Неопределено И НЕ УсловияПродажПоУмолчанию.Соглашение.Пустая() Тогда
		лОбъект.Соглашение = УсловияПродажПоУмолчанию.Соглашение;
		лОбъект.ЗаполнитьУсловияПродаж(УсловияПродажПоУмолчанию);
		//ПродажиСервер.ЗаполнитьЦеныПоСоглашению(лОбъект, ""Товары"", Истина);
	КонецЕсли;
КонецЕсли;

// дописываем вариант графика оплаты по умолчанию
лОбъект.ЭтапыГрафикаОплаты.Очистить();
лГрафик = лОбъект.ЭтапыГрафикаОплаты.Добавить();
лГрафик.ВариантОплаты = Перечисления.ВариантыОплатыКлиентом.КредитПослеОтгрузки;
лГрафик.ДатаПлатежа = лОбъект.ЖелаемаяДатаОтгрузки;
лГрафик.ПроцентПлатежа = 100;
лГрафик.СуммаПлатежа = лОбъект.СуммаДокумента;

//СтруктураПересчетаСуммы = ОбработкаТабличнойЧастиКлиентСервер.ПолучитьСтруктуруПересчетаСуммыНДСВСтрокеТЧ(лОбъект);
//СтруктураДействийЗаполнитьЦены.Вставить(""ПересчитатьСумму"");
//СтруктураДействийЗаполнитьЦены.Вставить(""ПересчитатьСуммуНДС"", СтруктураПересчетаСуммы);
//СтруктураДействийЗаполнитьЦены.Вставить(""ПересчитатьСуммуСНДС"", СтруктураПересчетаСуммы);
//СтруктураДействийЗаполнитьЦены.Вставить(""ПересчитатьСуммуРучнойСкидки"");
//СтруктураДействийЗаполнитьЦены.Вставить(""ОчиститьАвтоматическуюСкидку"");

СтруктураПересчетаСуммы.Вставить(""ЦенаВключаетНДС"", лОбъект.ЦенаВключаетНДС);

//СтруктураДействийОбработатьСтрокуЗаказа.Вставить(""ПересчитатьСуммуРучнойСкидки"");
СтруктураДействийОбработатьСтрокуЗаказа.Вставить(""ПересчитатьСумму"");
СтруктураДействийОбработатьСтрокуЗаказа.Вставить(""ПересчитатьСуммуСУчетомРучнойСкидки"", Новый Структура(""Очищать"", Ложь));
СтруктураДействийОбработатьСтрокуЗаказа.Вставить(""ПересчитатьСуммуСУчетомАвтоматическойСкидки"", Новый Структура(""Очищать"", Ложь));
СтруктураДействийОбработатьСтрокуЗаказа.Вставить(""ПересчитатьСуммуНДС"", СтруктураПересчетаСуммы);
//СтруктураДействийОбработатьСтрокуЗаказа.Вставить(""ПересчитатьСуммуСНДС"", СтруктураПересчетаСуммы);
//СтруктураДействийОбработатьСтрокуЗаказа.Вставить(""ЗаполнитьДубликатыЗависимыхРеквизитов"", Новый Структура(""Сумма, СуммаНДС, СуммаСНДС, СуммаАвтоматическойСкидки, СуммаРучнойСкидки""));

КэшированныеЗначения = ОбработкаТабличнойЧастиКлиентСервер.ПолучитьСтруктуруКэшируемыеЗначения();"			Заказ	Реализация
datetime	Дата		Дата и время документа								"// шапка
лОбъект.Валюта = Константы.ВалютаРегламентированногоУчета.Получить();
лОбъект.НалогообложениеНДС	= ?(лПеременные.УчитыватьНДС, Перечисления.ТипыНалогообложенияНДС.ПродажаОблагаетсяНДС, Перечисления.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС);

//лОбъект.БанковскийСчет = лОбъект.Организация.ОсновнойБанковскийСчет;

лРегистрАдрес = лОбъект.Партнер.КонтактнаяИнформация.НайтиСтроки(новый Структура(""Вид"", Справочники.ВидыКонтактнойИнформации.АдресПартнера));
лОбъект.АдресДоставки = ?(лРегистрАдрес.Количество() > 0, СокрЛП(лРегистрАдрес[0].Представление), """");

лОбъект.СкидкиРассчитаны = Истина;

лОбъект.Статус = Перечисления.СтатусыЗаказовКлиентов.КОтгрузке; 
лОбъект.Приоритет = Перечисления.Приоритеты.Средний;
лОбъект.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеализацияКлиенту;
//лОбъект.Менеджер = ПолучитьСотрудникаПоФизЛицу(лСотрудник);
//лОбъект.Подразделение = лОбъект.Менеджер.ТекущееПодразделение;

лОбъект.УстановитьВремя(РежимАвтоВремя.ТекущееИлиПоследним);
лОбъект.УстановитьНовыйНомер(лОбъект.Организация.Префикс);

Если ЗначениеЗаполнено(лОбъект.Партнер) Тогда
	УсловияПродажПоУмолчанию = ПродажиСервер.ПолучитьУсловияПродажПоУмолчанию(лОбъект.Партнер, лОбъект.Дата);
	Если УсловияПродажПоУмолчанию <> Неопределено И НЕ УсловияПродажПоУмолчанию.Соглашение.Пустая() Тогда
		лОбъект.Соглашение = УсловияПродажПоУмолчанию.Соглашение;
		лОбъект.ЗаполнитьУсловияПродаж(УсловияПродажПоУмолчанию);
		//ПродажиСервер.ЗаполнитьЦеныПоСоглашению(лОбъект, ""Товары"", Истина);
	КонецЕсли;
КонецЕсли;

// дописываем вариант графика оплаты по умолчанию
лОбъект.ЭтапыГрафикаОплаты.Очистить();
лГрафик = лОбъект.ЭтапыГрафикаОплаты.Добавить();
лГрафик.ВариантОплаты = Перечисления.ВариантыОплатыКлиентом.КредитПослеОтгрузки;
лГрафик.ДатаПлатежа = лОбъект.ЖелаемаяДатаОтгрузки;
лГрафик.ПроцентПлатежа = 100;
лГрафик.СуммаПлатежа = лОбъект.СуммаДокумента;

//СтруктураПересчетаСуммы = ОбработкаТабличнойЧастиКлиентСервер.ПолучитьСтруктуруПересчетаСуммыНДСВСтрокеТЧ(лОбъект);
//СтруктураДействийЗаполнитьЦены.Вставить(""ПересчитатьСумму"");
//СтруктураДействийЗаполнитьЦены.Вставить(""ПересчитатьСуммуНДС"", СтруктураПересчетаСуммы);
//СтруктураДействийЗаполнитьЦены.Вставить(""ПересчитатьСуммуСНДС"", СтруктураПересчетаСуммы);
//СтруктураДействийЗаполнитьЦены.Вставить(""ПересчитатьСуммуРучнойСкидки"");
//СтруктураДействийЗаполнитьЦены.Вставить(""ОчиститьАвтоматическуюСкидку"");

СтруктураПересчетаСуммы.Вставить(""ЦенаВключаетНДС"", лОбъект.ЦенаВключаетНДС);

//СтруктураДействийОбработатьСтрокуЗаказа.Вставить(""ПересчитатьСуммуРучнойСкидки"");
СтруктураДействийОбработатьСтрокуЗаказа.Вставить(""ПересчитатьСумму"");
СтруктураДействийОбработатьСтрокуЗаказа.Вставить(""ПересчитатьСуммуСУчетомРучнойСкидки"", Новый Структура(""Очищать"", Ложь));
СтруктураДействийОбработатьСтрокуЗаказа.Вставить(""ПересчитатьСуммуСУчетомАвтоматическойСкидки"", Новый Структура(""Очищать"", Ложь));
СтруктураДействийОбработатьСтрокуЗаказа.Вставить(""ПересчитатьСуммуНДС"", СтруктураПересчетаСуммы);
//СтруктураДействийОбработатьСтрокуЗаказа.Вставить(""ПересчитатьСуммуСНДС"", СтруктураПересчетаСуммы);
//СтруктураДействийОбработатьСтрокуЗаказа.Вставить(""ЗаполнитьДубликатыЗависимыхРеквизитов"", Новый Структура(""Сумма, СуммаНДС, СуммаСНДС, СуммаАвтоматическойСкидки, СуммаРучнойСкидки""));

КэшированныеЗначения = ОбработкаТабличнойЧастиТоварыКлиентСервер.ПолучитьСтруктуруКэшируемыеЗначения();"	"// шапка
лОбъект.Валюта = Константы.ВалютаРегламентированногоУчета.Получить();
лОбъект.НалогообложениеНДС	= ?(лПеременные.УчитыватьНДС, Перечисления.ТипыНалогообложенияНДС.ПродажаОблагаетсяНДС, Перечисления.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС);

//лОбъект.БанковскийСчет = лОбъект.Организация.ОсновнойБанковскийСчет;

лРегистрАдрес = лОбъект.Партнер.КонтактнаяИнформация.НайтиСтроки(новый Структура(""Вид"", Справочники.ВидыКонтактнойИнформации.АдресПартнера));
лОбъект.АдресДоставки = ?(лРегистрАдрес.Количество() > 0, СокрЛП(лРегистрАдрес[0].Представление), """");

лОбъект.СкидкиРассчитаны = Истина;

лОбъект.СтатусОтгрузки = Перечисления.СтатусыОтгрузки.КОтгрузке; 
//лОбъект.Приоритет = Перечисления.Приоритеты.Средний;
лОбъект.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеализацияКлиенту;
//лОбъект.Менеджер = ПолучитьСотрудникаПоФизЛицу(лСотрудник);
лОбъект.Подразделение = лОбъект.Менеджер.ТекущееПодразделение;

лОбъект.УстановитьВремя(РежимАвтоВремя.ТекущееИлиПоследним);
лОбъект.УстановитьНовыйНомер(лОбъект.Организация.Префикс);

Если ЗначениеЗаполнено(лОбъект.Партнер) Тогда
	УсловияПродажПоУмолчанию = ПродажиСервер.ПолучитьУсловияПродажПоУмолчанию(лОбъект.Партнер, лОбъект.Дата);
	Если УсловияПродажПоУмолчанию <> Неопределено И НЕ УсловияПродажПоУмолчанию.Соглашение.Пустая() Тогда
		лОбъект.Соглашение = УсловияПродажПоУмолчанию.Соглашение;
		лОбъект.ЗаполнитьУсловияПродаж(УсловияПродажПоУмолчанию);
		//ПродажиСервер.ЗаполнитьЦеныПоСоглашению(лОбъект, ""Товары"", Истина);
	КонецЕсли;
КонецЕсли;

//СтруктураПересчетаСуммы = ОбработкаТабличнойЧастиКлиентСервер.ПолучитьСтруктуруПересчетаСуммыНДСВСтрокеТЧ(лОбъект);
//СтруктураДействийЗаполнитьЦены.Вставить(""ПересчитатьСумму"");
//СтруктураДействийЗаполнитьЦены.Вставить(""ПересчитатьСуммуНДС"", СтруктураПересчетаСуммы);
//СтруктураДействийЗаполнитьЦены.Вставить(""ПересчитатьСуммуСНДС"", СтруктураПересчетаСуммы);
//СтруктураДействийЗаполнитьЦены.Вставить(""ПересчитатьСуммуРучнойСкидки"");
//СтруктураДействийЗаполнитьЦены.Вставить(""ОчиститьАвтоматическуюСкидку"");

СтруктураПересчетаСуммы.Вставить(""ЦенаВключаетНДС"", лОбъект.ЦенаВключаетНДС);

//СтруктураДействийОбработатьСтрокуЗаказа.Вставить(""ПересчитатьСуммуРучнойСкидки"");
СтруктураДействийОбработатьСтрокуЗаказа.Вставить(""ПересчитатьСумму"");
СтруктураДействийОбработатьСтрокуЗаказа.Вставить(""ПересчитатьСуммуСУчетомРучнойСкидки"", Новый Структура(""Очищать"", Ложь));
СтруктураДействийОбработатьСтрокуЗаказа.Вставить(""ПересчитатьСуммуСУчетомАвтоматическойСкидки"", Новый Структура(""Очищать"", Ложь));
СтруктураДействийОбработатьСтрокуЗаказа.Вставить(""ПересчитатьСуммуНДС"", СтруктураПересчетаСуммы);
//СтруктураДействийОбработатьСтрокуЗаказа.Вставить(""ПересчитатьСуммуСНДС"", СтруктураПересчетаСуммы);
//СтруктураДействийОбработатьСтрокуЗаказа.Вставить(""ЗаполнитьДубликатыЗависимыхРеквизитов"", Новый Структура(""Сумма, СуммаНДС, СуммаСНДС, СуммаАвтоматическойСкидки, СуммаРучнойСкидки""));

КэшированныеЗначения = ОбработкаТабличнойЧастиКлиентСервер.ПолучитьСтруктуруКэшируемыеЗначения();"
printcode			Код объекта									
deleted	ПометкаУдаления		Пометка на удаление									
docstate		ref_docstates	Ссылка на статус состояния документа									
pricetype	*ВидЦены	ref_pricetypes	Ссылка на тип цены									
employee	Менеджер	ref_employees	Ссылка на сотрудника									
firm	Организация	ref_firms	Ссылка на собственную фирму									
store	Склад	ref_stores	Ссылка на склад									
buyer		ref_buyers	Ссылка на владельца / покупателя									
buypoint	Партнер	ref_buypoints	Ссылка на торговую точку									
counteragent	Контрагент	ref_counteragents	Ссылка на контрагента / юр. лицо / плательщика									
agreement	Соглашение	ref_agreements	Ссылка на договор									
paytype		ref_paytypes	Ссылка на тип оплаты									
deliverydate	ЖелаемаяДатаОтгрузки		Планируемая дата доставки									
deliverytimefrom			Временной интервал доставки, от									
deliverytimetill			Временной интервал доставки, до									
comment	Комментарий		Произвольный комментарий									
extrarate			Процент общей наценки / скидки на документ									
includevat	*ЦенаВключаетНДС		НДС включен в сумму									
usevat	*НалогообложениеНДС		Учитывать НДС					лПеременные.Вставить("УчитыватьНДС",?(лЗначение="true",Истина,Ложь));				
amount	СуммаДокумента		Сумма									
processed			Признак проведения документа									
status			Х									
												
Заявки (ТЧ)												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
deleted			Пометка на удаление		Товары	Х		"// строка ТЧ
стрТЧ.СтавкаНДС = стрТЧ.Номенклатура.СтавкаНДС; //Перечисления.СтавкиНДС.БезНДС
стрТЧ.Склад = лОбъект.Склад;
стрТЧ.Упаковка = ПолучитьЕдиницуТовара_11(стрТЧ, лПеременные.ЕдиницаПоКлассификатору, лПеременные.Коэффициент);
стрТЧ.КоличествоУпаковок = стрТЧ.КоличествоУпаковок/лПеременные.Коэффициент;
стрТЧ.ДатаОтгрузки = лОбъект.ЖелаемаяДатаОтгрузки;

ОбработкаТабличнойЧастиСервер.ОбработатьСтрокуТЧ(стрТЧ, СтруктураДействийОбработатьСтрокуЗаказа, КэшированныеЗначения);"				
sku	Номенклатура	ref_skus	Ссылка на товар									
unit	Упаковка	ref_units	Ссылка на единицу измерения					лПеременные.Вставить("ЕдиницаПоКлассификатору",XMLЗначение(Тип(элТЗЭ.Представление),лЗначение));				
pricetype	ВидЦены	ref_pricetypes	Ссылка на тип цены									
factor	Количество		Коэффициент пересчета в базовую единицу измерения					лПеременные.Вставить("Коэффициент",Число(лЗначение));				
quantity	КоличествоУпаковок		Количество в выбранной единице измерения									
extrarate			Процент наценки / скидки									
vatrate	*СтавкаНДС		Процент ставки НДС									
price	Цена		Цена за выбранную единицу измерения без учета скидок / наценок									
												
												
ПКО												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке	В конце загрузки док.			
					Х	Х		"// шапка
лОбъект.Валюта = Константы.ВалютаРегламентированногоУчета.Получить();
лОбъект.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ПоступлениеОплатыОтКлиента;
лОбъект.СтатьяДвиженияДенежныхСредств = Справочники.СтатьиДвиженияДенежныхСредств.ПоступлениеОплатыОтКлиента;
лОбъект.Касса = ПолучитьКассу(лОбъект.Организация);
лОбъект.ПринятоОт = ?(лОбъект.Контрагент=Неопределено,"""",?(ПустаяСтрока(лОбъект.Контрагент.НаименованиеПолное), лОбъект.Контрагент.Наименование, лОбъект.Контрагент.НаименованиеПолное));

лОбъект.Касса = ОбщегоНазначения.ХранилищеОбщихНастроекЗагрузить(""ТекущаяКасса"",);
Если Не ЗначениеЗаполнено(лОбъект.Касса) Тогда
	лОбъект.Касса = Справочники.Кассы.ПолучитьКассуПоУмолчанию(
		?(ЗначениеЗаполнено(лОбъект.Организация), лОбъект.Организация, Неопределено),
		?(ЗначениеЗаполнено(лОбъект.Валюта), лОбъект.Валюта, Неопределено));
КонецЕсли;
Если ЗначениеЗаполнено(лОбъект.Касса) Тогда
	СтруктураРеквизитов = Справочники.Кассы.ПолучитьРеквизитыКассы(лОбъект.Касса);
	лОбъект.Организация = СтруктураРеквизитов.Организация;
	лОбъект.Валюта = СтруктураРеквизитов.Валюта;
КонецЕсли;

лОбъект.УстановитьВремя(РежимАвтоВремя.ТекущееИлиПоследним);
//лОбъект.УстановитьНовыйНомер(лОбъект.Организация.Префикс);"				
datetime	Дата		Дата и время документа									
printcode			Код объекта									
deleted	ПометкаУдаления		Пометка на удаление									
docstate		ref_docstates	Ссылка на статус состояния документа									
employee	*Ответственный	ref_employees	Ссылка на сотрудника									
firm	Организация	ref_firms	Ссылка на собственную фирму									
cashregister	*Касса	ref_cashregisters	Ссылка на кассу									
buyer		ref_buyers	Ссылка на владельца / покупателя									
buypoint		ref_buypoints	Ссылка на торговую точку									
counteragent	Контрагент	ref_counteragents	Ссылка на контрагента / юр. лицо / плательщика									
agreement	*Соглашение	ref_agreements	Ссылка на договор									
comment	Комментарий		Произвольный комментарий									
amount	СуммаДокумента		Сумма									
processed			Признак проведения документа									
												
ПКО (ТЧ)												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
deleted			Пометка на удаление		РасшифровкаПлатежа	Х		"// строка ТЧ
//стрТЧ.СтатьяДвиженияДенежныхСредств = лОбъект.СтатьяДвиженияДенежныхСредств;
стрТЧ.СуммаВзаиморасчетов = стрТЧ.Сумма;
стрТЧ.ВалютаВзаиморасчетов = лОбъект.Валюта;

стрТЧ.Заказ = ПолучитьОснованиеДляПКО(лПеременные.docinfo, лПеременные.invoice, ТипыЗначенийЭлементов);
//Если ЗначениеЗаполнено(стрТЧ.ДокументРасчетовСКонтрагентом) Тогда
//	стрТЧ.Сделка = стрТЧ.ДокументРасчетовСКонтрагентом.Сделка;
//КонецЕсли;"				
buypoint	Партнер	ref_buypoints	Ссылка на торговую точку									
firm		ref_firms	Ссылка на собственную фирму									
counteragent		ref_counteragents	Ссылка на контрагента / юр. лицо / плательщика									
agreement		ref_agreements	Ссылка на договор									
docinfo	Заказ		Описание документа задолженности					лПеременные.Вставить("docinfo",лЗначение);				
invoice_guid	Заказ	doc_invoices	Ссылка на документ задолженности					лПеременные.Вставить("invoice",лЗначение);				
amount	Сумма		Сумма задолженности									
												
												
Возвраты												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке	В конце загрузки док.			
					Х	Х		"// шапка
лОбъект.Валюта = Константы.ВалютаРегламентированногоУчета.Получить();

лПеременные.Вставить(""УчитыватьНДС"", Истина);
//лОбъект.ЦенаВключаетНДС = лОбъект.ВидЦены.ЦенаВключаетНДС;

лОбъект.НалогообложениеНДС	= ?(лПеременные.УчитыватьНДС, Перечисления.ТипыНалогообложенияНДС.ПродажаОблагаетсяНДС, Перечисления.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС);

лОбъект.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ВозвратТоваровОтКлиента;
//лОбъект.ТипЦен = лОбъект.ДоговорКонтрагента.ТипЦен;
лОбъект.Подразделение = лОбъект.Менеджер.ТекущееПодразделение;

лОбъект.УстановитьВремя(РежимАвтоВремя.ТекущееИлиПоследним);
//лОбъект.УстановитьНовыйНомер(лОбъект.Организация.Префикс);

Если ЗначениеЗаполнено(лОбъект.Соглашение) Тогда
	лОбъект.ЗаполнитьУсловияПродажПоCоглашению();
ИначеЕсли ЗначениеЗаполнено(лОбъект.Партнер) Тогда
	УсловияПродажПоУмолчанию = ПродажиСервер.ПолучитьУсловияПродажПоУмолчанию(лОбъект.Партнер, лОбъект.Дата);
	Если УсловияПродажПоУмолчанию <> Неопределено И НЕ УсловияПродажПоУмолчанию.Соглашение.Пустая() Тогда
		лОбъект.Соглашение = УсловияПродажПоУмолчанию.Соглашение;
		лОбъект.ЗаполнитьУсловияПродаж(УсловияПродажПоУмолчанию);
		//ПродажиСервер.ЗаполнитьЦеныПоСоглашению(лОбъект, ""Товары"", Истина);
	КонецЕсли;
КонецЕсли;

СтруктураПересчетаСуммы.Вставить(""ЦенаВключаетНДС"", лОбъект.ЦенаВключаетНДС);

СтруктураДействийОбработатьСтрокуВозврата.Вставить(""ПересчитатьКоличествоЕдиниц"");
//СтруктураДействийОбработатьСтрокуВозврата.Вставить(""ЗаполнитьСтавкуНДС"", лОбъект.ЦенаВключаетНДС);
СтруктураДействийОбработатьСтрокуВозврата.Вставить(""ПересчитатьСуммуНДС"", СтруктураПересчетаСуммы);
СтруктураДействийОбработатьСтрокуВозврата.Вставить(""ПересчитатьСумму"");
//СтруктураДействийОбработатьСтрокуВозврата.Вставить(""ПересчитатьСуммуCНДС"", СтруктураПересчетаСуммы);

КэшированныеЗначения = ОбработкаТабличнойЧастиКлиентСервер.ПолучитьСтруктуруКэшируемыеЗначения();"	"// финиш
//ПродажиСервер.ЗаполнитьЦеныПоСоглашению(лОбъект, ""Товары"");"			
datetime	Дата		Дата и время документа									
printcode			Код объекта									
deleted	ПометкаУдаления		Пометка на удаление									
docstate		ref_docstates	Ссылка на статус состояния документа									
pricetype	*ТипЦен	ref_pricetypes	Ссылка на тип цены									
employee	Менеджер	ref_employees	Ссылка на сотрудника									
firm	Организация	ref_firms	Ссылка на собственную фирму									
store	Склад	ref_stores	Ссылка на склад									
buyer		ref_buyers	Ссылка на владельца / покупателя									
buypoint	Партнер	ref_buypoints	Ссылка на торговую точку									
counteragent	Контрагент	ref_counteragents	Ссылка на контрагента / юр. лицо / плательщика									
agreement	Соглашение	ref_agreements	Ссылка на договор									
paytype		ref_paytypes	Ссылка на тип оплаты									
deliverydate			Планируемая дата доставки									
deliverytimefrom			Временной интервал доставки, от									
deliverytimetill			Временной интервал доставки, до									
comment	Комментарий		Произвольный комментарий									
extrarate			Процент общей наценки / скидки на документ									
includevat	*ЦенаВключаетНДС		НДС включен в сумму									
usevat	*НалогообложениеНДС		Учитывать НДС					лПеременные.Вставить("УчитыватьНДС",?(лЗначение="true",Истина,Ложь));				
amount	СуммаДокумента		Сумма									
processed			Признак проведения документа									
												
Возвраты (ТЧ)												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
deleted			Пометка на удаление		Товары	Х		"// строка ТЧ
стрТЧ.СтавкаНДС = стрТЧ.Номенклатура.СтавкаНДС; //Перечисления.СтавкиНДС.БезНДС
стрТЧ.Упаковка = ПолучитьЕдиницуТовара_11(стрТЧ, лПеременные.ЕдиницаПоКлассификатору, лПеременные.Коэффициент);
стрТЧ.КоличествоУпаковок = стрТЧ.КоличествоУпаковок/лПеременные.Коэффициент;

ОбработкаТабличнойЧастиСервер.ОбработатьСтрокуТЧ(стрТЧ, СтруктураДействийОбработатьСтрокуВозврата, КэшированныеЗначения);"				
sku	Номенклатура	ref_skus	Ссылка на товар									
unit	Упаковка	ref_units	Ссылка на единицу измерения					лПеременные.Вставить("ЕдиницаПоКлассификатору",XMLЗначение(Тип(элТЗЭ.Представление),лЗначение));				
pricetype		ref_pricetypes	Ссылка на тип цены									
factor	Количество		Коэффициент пересчета в базовую единицу измерения					лПеременные.Вставить("Коэффициент",Число(лЗначение));				
quantity	КоличествоУпаковок		Количество в выбранной единице измерения									
extrarate			Процент наценки / скидки									
vatrate	*СтавкаНДС		Процент ставки НДС									
price	Цена		Цена за выбранную единицу измерения без учета скидок / наценок									
overdue			Товар просрочен									
												
												
Перепись (сенсус) владельцев торговых точек												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
					Х	Х		"// заполнение данных
//лОбъект.Комментарий = """"+ лПеременные.employee +"" # ""+ лПеременные.comment;

лСенсус = Неопределено;
лКонстанты.Свойство(""Сенсус"",лСенсус);
Если лСенсус=Неопределено Тогда
	лСенсус = Новый ТаблицаЗначений;
	лСенсус.Колонки.Добавить(""buyer"");
	лСенсус.Колонки.Добавить(""Ссылка"");
КонецЕсли;

элТЗЭ = ТипыЗначенийЭлементов.НайтиПоЗначению(""ref_buyers"");
Если ЗначениеЗаполнено(лПеременные.buyer_did) Тогда
	лОбъектСсылка = XMLЗначение(Тип(элТЗЭ.Представление),лПеременные.buyer_did);
	лОбъект = лОбъектСсылка.ПолучитьОбъект();
	СообщитьПодробно(""Обновляем объект ""+лОбъект+"" (""+лПеременные.buyer+"")"", СтатусСообщения.Обычное, Истина, ЗаписьВЖурнал);
Иначе
	стрТПО = ТаблицаПринятыхОбъектов.Найти(лПеременные.buyer, ""did"");
	Если стрТПО=Неопределено Тогда
		лОбъектСсылка = Справочники.Контрагенты.ПолучитьСсылку();
		лОбъект.УстановитьСсылкуНового(лОбъектСсылка);
	Иначе
		лОбъектСсылка = XMLЗначение(Тип(элТЗЭ.Представление), стрТПО.sid);
		лОбъект = лОбъектСсылка.ПолучитьОбъект();
		СообщитьПодробно(""Обновляем объект ""+лОбъект+"" (""+стрТПО.sid+"")"", СтатусСообщения.Обычное, Истина, ЗаписьВЖурнал);
	КонецЕсли;
КонецЕсли;

лОбъект.Наименование = ""#""+лПеременные.name;
лОбъект.ДополнительнаяИнформация = 
	""Адрес: ""+лПеременные.address+Символы.ПС+
	""Телефон: ""+лПеременные.phone+Символы.ПС+
	""Контактное лицо: ""+лПеременные.contact+Символы.ПС+
	""Комментарий: ""+лПеременные.employee+"" # ""+лПеременные.comment;
лОбъект.ЮридическоеФизическоеЛицо = Перечисления.ЮридическоеФизическоеЛицо.ЮридическоеЛицо;
лОбъект.ЮрФизЛицо = Перечисления.ЮрФизЛицо.ЮрЛицо;

лСтрСенсус = лСенсус.Добавить();
лСтрСенсус.buyer = лПеременные.buyer;
лСтрСенсус.Ссылка =лОбъектСсылка;

лКонстанты.Вставить(""Сенсус"",лСенсус);

ДополнительноеПодтверждение(лКонстанты, ""ref_buyers"", лОбъектСсылка, лПеременные.buyer, ТаблицаПринятыхОбъектов);"				
name	Наименование		Наименование					лПеременные.Вставить("name",лЗначение);				
printcode	*Код		Код объекта									
deleted	*ПометкаУдаления		Пометка на удаление									
store		ref_stores	Ссылка на склад отгрузки									
pricetype	*ТипЦен	ref_pricetypes	Ссылка на тип цен									
address	Наименование		Адрес					лПеременные.Вставить("address",лЗначение);				
phone	Наименование		Телефон					лПеременные.Вставить("phone",лЗначение);				
contact	Наименование		Контактное лицо					лПеременные.Вставить("contact",лЗначение);				
canexceedlimit	*КонтролироватьЧислоДнейЗадолженности		Признак разрешения превышать срок кредита									
creditlimit	*ДопустимаяСуммаЗадолженности		Ограничение суммы кредита в основной валюте									
creditdeadline	*ДопустимоеЧислоДнейЗадолженности		Ограничение глубины кредита в днях									
maxorderamount			Ограничение максимальной сумма заказа									
minorderamount			Ограничение минимальной сумма заказа									
maxdiscount			Ограничение максимального процента скидки									
mindiscount			Ограничение минимального процента скидки									
censusapproved												
buyer	Наименование	ref_buyers						лПеременные.Вставить("buyer",tag.firstChild.getAttribute("sid")); лПеременные.Вставить("buyer_did",tag.firstChild.getAttribute("did"));				
comment	Наименование							лПеременные.Вставить("comment",лЗначение);				
employee	Наименование	ref_employees						лПеременные.Вставить("employee",XMLЗначение(Тип(элТЗЭ.Представление),лЗначение));				
												
												
Сенсус (перепись) торговых точек												
Мобиком	Источник	Ссылка	Описание		Запрос	Есть условие	Доп. при выгрузке	Доп. при загрузке				
					Х	Х		"// заполнение данных
лСенсус = Неопределено;
лКонстанты.Свойство(""Сенсус"",лСенсус);
Если лСенсус=Неопределено Тогда
	лСенсус = Новый ТаблицаЗначений;
	лСенсус.Колонки.Добавить(""buyer"");
	лСенсус.Колонки.Добавить(""Ссылка"");
КонецЕсли;

элТЗЭ = ТипыЗначенийЭлементов.НайтиПоЗначению(""ref_buypoints"");
Если ЗначениеЗаполнено(лПеременные.buypoint_did) Тогда
	лОбъектСсылка = XMLЗначение(Тип(элТЗЭ.Представление),лПеременные.buypoint_did);
	лОбъект = лОбъектСсылка.ПолучитьОбъект();
	СообщитьПодробно(""Обновляем объект ""+лОбъект+"" (""+лПеременные.buypoint+"")"", СтатусСообщения.Обычное, Истина, ЗаписьВЖурнал);
Иначе
	стрТПО = ТаблицаПринятыхОбъектов.Найти(лПеременные.buypoint, ""did"");
	Если стрТПО=Неопределено Тогда
		лОбъектСсылка = Справочники.Партнеры.ПолучитьСсылку();
		лОбъект.УстановитьСсылкуНового(лОбъектСсылка);
	Иначе
		лОбъектСсылка = XMLЗначение(Тип(элТЗЭ.Представление), стрТПО.sid);
		лОбъект = лОбъектСсылка.ПолучитьОбъект();
		СообщитьПодробно(""Обновляем объект ""+лОбъект+"" (""+стрТПО.sid+"")"", СтатусСообщения.Обычное, Истина, ЗаписьВЖурнал);
	КонецЕсли;
КонецЕсли;

Если лПеременные.Свойство(""buyer"") Тогда
	Если ЗначениеЗаполнено(лПеременные.buyer_did) Тогда
		элТЗЭ = ТипыЗначенийЭлементов.НайтиПоЗначению(""ref_buyers"");
		лГлавныйКонтрагент = XMLЗначение(Тип(элТЗЭ.Представление),лПеременные.buyer_did);
	Иначе
		стрСенсус = лСенсус.Найти(лПеременные.buyer,""buyer"");
		Если стрСенсус=Неопределено Тогда
			лГлавныйКонтрагент = Неопределено;
		Иначе
			лГлавныйКонтрагент = стрСенсус.Ссылка;
			лСенсус.Удалить(стрСенсус); // иначе если несколько новых точек заведены на одного нового владельца - нужна обработка иерархии
		КонецЕсли;
	КонецЕсли;
Иначе
	лГлавныйКонтрагентОбъект = Справочники.Контрагенты.СоздатьЭлемент();
	лГлавныйКонтрагентОбъект.Наименование = ""#""+лПеременные.name;
	лГлавныйКонтрагентОбъект.НаименованиеПолное = лПеременные.fullname;
	лГлавныйКонтрагентОбъект.ЮрФизЛицо = Перечисления.ЮрФизЛицо.ЮрЛицо;
	//лГлавныйКонтрагентОбъект.Партнер = лОбъектСсылка;
	лГлавныйКонтрагентОбъект.Записать();
	СообщитьПодробно(""Создали контрагента для ТТ (""+лПеременные.buypoint+"")"", СтатусСообщения.Обычное, Истина, ЗаписьВЖурнал);

	лГлавныйКонтрагент = лГлавныйКонтрагентОбъект.Ссылка;
КонецЕсли;
Если лГлавныйКонтрагент<>Неопределено Тогда
	лПартнерРодитель = лГлавныйКонтрагент.Партнер;
	Если ЗначениеЗаполнено(лПартнерРодитель) Тогда
		лОбъект.Родитель = лПартнерРодитель;
	Иначе
		лКонтрагентОбъект = лГлавныйКонтрагент.ПолучитьОбъект();
		лКонтрагентОбъект.Партнер = лОбъектСсылка;
		лКонтрагентОбъект.Записать();
	КонецЕсли;
КонецЕсли;

лОбъект.Наименование = ""#""+лПеременные.name;
лОбъект.НаименованиеПолное = лПеременные.fullname;
лОбъект.Комментарий = """"+ лПеременные.employee +"" # ""+ лПеременные.comment;
лОбъект.ОсновнойМенеджер = лПеременные.employee;

лОбъект.ДополнительнаяИнформация = 
	""Адрес: ""+лПеременные.address+Символы.ПС+
	""Телефон: ""+лПеременные.phone+Символы.ПС+
	""Контактное лицо: ""+лПеременные.contact;

лОбъект.Клиент = Истина;
//лОбъект.ЮрФизЛицо = Перечисления.КомпанияЧастноеЛицо.Компания;

ДополнительноеПодтверждение(лКонстанты, ""ref_buypoints"", лОбъектСсылка, лПеременные.buypoint, ТаблицаПринятыхОбъектов);"				
name	Наименование		Наименование					лПеременные.Вставить("name",лЗначение);				
printcode	*Код		Код объекта									
deleted	*ПометкаУдаления		Пометка на удаление									
buyer	Комментарий	ref_buyers	Ссылка на владельца / покупателя					лПеременные.Вставить("buyer",tag.firstChild.getAttribute("sid")); лПеременные.Вставить("buyer_did",tag.firstChild.getAttribute("did"));				
store		ref_stores	Ссылка на склад отгрузки									
pricetype	*ТипЦен	ref_pricetypes	Ссылка на тип цен									
buypointtype	Родитель	ref_buypointtypes	Ссылка на тип торговой точки									
fullname	НаименованиеПолное		Полное наименование					лПеременные.Вставить("fullname",лЗначение);				
address	Комментарий		Адрес					лПеременные.Вставить("address",лЗначение);				
phone	Комментарий		Телефон					лПеременные.Вставить("phone",лЗначение);				
contact	Комментарий		Контактное лицо					лПеременные.Вставить("contact",лЗначение);				
vatstatus			Плательщик НДС									
canexceedlimit	*КонтролироватьЧислоДнейЗадолженности		Признак разрешения превышать срок кредита									
creditlimit	*ДопустимаяСуммаЗадолженности		Ограничение суммы кредита в основной валюте									
creditdeadline	*ДопустимоеЧислоДнейЗадолженности		Ограничение глубины кредита в днях									
maxorderamount			Ограничение максимальной сумма заказа									
minorderamount			Ограничение минимальной сумма заказа									
maxdiscount			Ограничение максимального процента скидки									
mindiscount			Ограничение минимального процента скидки									
extrarate			Процент наценки / скидки									
censusapproved												
buypoint	Комментарий	ref_buypoints						лПеременные.Вставить("buypoint",tag.firstChild.getAttribute("sid")); лПеременные.Вставить("buypoint_did",tag.firstChild.getAttribute("did"));				
comment	Комментарий							лПеременные.Вставить("comment",лЗначение);				
employee	Комментарий	ref_employees						лПеременные.Вставить("employee",XMLЗначение(Тип(элТЗЭ.Представление),лЗначение));				
												
												
												
												
												
												
												
												
												
												
												
												
												
												
												
												
												
												
												
												